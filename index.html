<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAA ENGINEERING LINK HUB - SECURE</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        html { scroll-behavior: smooth; }
        .sidebar-bg, .login-bg {
            background-color: #222629;
            background-image: url('https://res.cloudinary.com/dzgov6mcu/image/upload/v1770112701/Gemini_Generated_Image_avn34iavn34iavn3_k2ry12.png');
            background-blend-mode: overlay;
            background-size: cover;
            background-position: center; 
        }
        .dark-overlay { background-color: rgba(0, 0, 0, 0.75); }
        
        @keyframes slide-up {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-up { animation: slide-up 0.3s ease-out forwards; }

        .dashboard-card {
            background: rgba(31, 41, 55, 0.6);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(75, 85, 99, 0.4);
            transition: all 0.3s ease;
            position: relative;
        }
        .dashboard-card:hover {
            border-color: rgba(96, 165, 250, 0.6);
            transform: translateY(-2px);
            background: rgba(31, 41, 55, 0.8);
        }

        /* Fullscreen Styles - Adjusted to respect Sidebar */
        .card-fullscreen {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 49 !important; 
            margin: 0 !important;
            border-radius: 0 !important;
            background: rgba(17, 24, 39, 0.98) !important; 
            backdrop-filter: none !important;
            transform: none !important;
            padding: 20px !important;
            display: flex;
            flex-direction: column;
            overflow-y: auto !important;
        }

        @media (min-width: 768px) {
            .card-fullscreen {
                left: 16rem !important;
                width: calc(100vw - 16rem) !important;
            }
        }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.1); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(96, 165, 250, 0.5); border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(96, 165, 250, 0.8); }

        /* Loading Spinner */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="font-sans text-gray-600 bg-white overflow-hidden h-screen">

    <!-- Login Screen -->
    <div id="login-screen" class="fixed inset-0 z-[100] login-bg flex items-center justify-center">
        <div class="absolute inset-0 bg-black bg-opacity-80"></div>
        <div class="relative z-10 bg-gray-900 bg-opacity-90 p-8 rounded-2xl shadow-2xl max-w-md w-full border border-gray-700 text-center backdrop-blur-md">
            <div class="mb-6 flex justify-center">
                <img src="https://res.cloudinary.com/dzgov6mcu/image/upload/v1770126241/logomaa_wwii3a.png" alt="MAA Logo" class="w-24 h-24 rounded-full border-4 border-gray-600 shadow-lg object-cover">
            </div>
            <h1 class="text-2xl font-bold text-white mb-1">MAA ENGINEERING</h1>
            <p class="text-gray-400 text-sm mb-8 tracking-widest uppercase">Secured Access Portal</p>
            
            <div id="login-error" class="hidden bg-red-500 bg-opacity-20 border border-red-500 text-red-200 p-3 rounded mb-4 text-xs text-left">
                <i class="fa-solid fa-circle-exclamation mr-1"></i> <span id="error-msg">Error</span>
            </div>
            
            <button id="google-login-btn" class="w-full bg-white text-gray-800 font-bold py-3 px-4 rounded-lg flex items-center justify-center hover:bg-gray-100 transition shadow-lg group">
                <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-6 h-6 mr-3" alt="Google">
                Sign in with Google
            </button>
            
            <div id="loading-indicator" class="hidden flex justify-center items-center py-3 flex-col">
                <div class="flex items-center mb-2">
                    <div class="loader mr-2"></div>
                    <span class="text-white text-sm">Logging in...</span>
                </div>
                <span id="loading-subtext" class="text-xs text-gray-400">Please wait</span>
            </div>
            <p class="mt-6 text-xs text-gray-500">Restricted access for <span class="text-gray-300">@airasia.com</span> only.</p>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="export-modal" class="hidden fixed inset-0 z-[200] flex items-center justify-center bg-black bg-opacity-80 backdrop-blur-sm">
        <div class="bg-gray-800 rounded-lg w-11/12 max-w-2xl border border-gray-600 shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
            <div class="flex justify-between items-center p-4 border-b border-gray-700 bg-gray-900">
                <h3 class="text-white font-bold text-lg"><i class="fa-solid fa-file-export mr-2 text-purple-400"></i> Export Data (Plain Text)</h3>
                <button onclick="closeExportModal()" class="text-gray-400 hover:text-white transition"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <div class="p-0 flex-1 overflow-hidden relative">
                <textarea id="export-textarea" class="w-full h-64 md:h-96 bg-gray-900 text-green-400 font-mono text-xs p-4 border-none resize-none focus:ring-0 outline-none leading-relaxed" readonly></textarea>
            </div>
            <div class="p-4 border-t border-gray-700 bg-gray-900 flex justify-end space-x-3">
                <button onclick="copyExportData()" class="px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded text-sm font-semibold transition flex items-center"><i class="fa-regular fa-copy mr-2"></i> Copy to Clipboard</button>
                <button onclick="closeExportModal()" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded text-sm font-semibold transition">Close</button>
            </div>
        </div>
    </div>

    <!-- DDML Details Modal -->
    <div id="ddml-details-modal" class="hidden fixed inset-0 z-[200] flex items-center justify-center bg-black bg-opacity-80 backdrop-blur-sm">
        <div class="bg-gray-800 rounded-lg w-11/12 max-w-5xl border border-gray-600 shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
            <div class="flex justify-between items-center p-4 border-b border-gray-700 bg-gray-900 shrink-0">
                <h3 class="text-white font-bold text-lg flex items-center gap-2">
                    <i class="fa-solid fa-list-check text-blue-400"></i>
                    <span id="ddml-modal-title">DDML Details</span>
                </h3>
                <button onclick="closeDDMLModal()" class="text-gray-400 hover:text-white transition"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <div class="p-0 flex-1 overflow-auto custom-scrollbar relative bg-gray-900/50">
                <table class="w-full text-left border-collapse">
                    <thead class="bg-gray-800 text-gray-400 text-[10px] uppercase sticky top-0 z-10 shadow-md">
                        <tr>
                            <th class="px-3 py-3 text-center w-[12%] border-b border-gray-700">A/C Reg.</th>
                            <th class="px-3 py-3 text-left w-[44%] border-b border-gray-700">Defect Description</th>
                            <th class="px-3 py-3 text-center w-[16%] border-b border-gray-700">DDML No.</th>
                            <th class="px-3 py-3 text-center w-[14%] border-b border-gray-700">Raised Date</th>
                            <th class="px-3 py-3 text-center w-[14%] border-b border-gray-700">Expiry</th>
                        </tr>
                    </thead>
                    <tbody id="ddml-modal-tbody">
                        <!-- Data will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Main App Content -->
    <div id="app-content" class="hidden flex-col md:flex-row h-screen w-full overflow-hidden">
        
        <button id="mobile-menu-btn" class="fixed top-4 left-4 z-[60] text-white bg-gray-800 bg-opacity-80 p-3 rounded-md md:hidden hover:bg-gray-700 transition shadow-lg border border-gray-600">
            <i class="fa-solid fa-bars text-xl"></i>
        </button>

        <!-- Sidebar -->
        <div id="header" class="fixed inset-y-0 left-0 w-64 h-screen sidebar-bg text-white shadow-2xl z-50 transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out flex flex-col">
            <div class="dark-overlay w-full h-full flex flex-col">
                <div class="p-6 text-right flex flex-col items-end">
                    <div class="mb-4">
                        <img src="https://res.cloudinary.com/dzgov6mcu/image/upload/v1770126241/logomaa_wwii3a.png" alt="MAA Logo" class="w-16 h-16 rounded-full border-2 border-gray-500 ml-auto object-cover">
                    </div>
                    <h1 class="text-xl font-bold leading-tight">MAA</h1>
                    <h1 class="text-xl font-bold leading-tight text-gray-300">ENGINEERING</h1>
                    <h1 class="text-xs font-light tracking-widest mt-1 text-gray-400">MOC LINKS HUB</h1>
                    <p class="text-[10px] text-green-400 mt-2 font-mono"><i class="fa-solid fa-signal"></i> Live System</p>
                </div>

                <nav class="flex-1 overflow-y-auto px-6 py-2">
                    <ul class="space-y-4 text-right">
                        <li><a href="#projects" class="group flex items-center justify-end space-x-3 text-gray-400 hover:text-white transition"><span class="text-sm uppercase tracking-wide group-hover:underline">Projects</span><i class="fa-solid fa-shuttle-space text-lg w-6 text-center"></i></a></li>
                        <li><a href="https://docs.google.com/spreadsheets/d/1aK1OnCUElKyhSSWp9B93IHANhwpEO3nnStUcFITxzs0/edit?gid=880994923#gid=880994923" target="_blank" class="group flex items-center justify-end space-x-3 text-gray-400 hover:text-white transition"><span class="text-sm uppercase tracking-wide group-hover:underline text-[11px]">MASTER MAINT PLANNING 2026</span><i class="fa-solid fa-file-signature text-lg w-6 text-center"></i></a></li>
                        <li><a href="https://docs.google.com/spreadsheets/d/1feAD2dXpGe6V_55qVL0AdpghzPQ2_mnlSE5H21xNkL8/edit?gid=1352464537#gid=1352464537" target="_blank" class="group flex items-center justify-end space-x-3 text-gray-400 hover:text-white transition"><span class="text-sm uppercase tracking-wide group-hover:underline text-[11px]">HANDOVER SHEET</span><i class="fa-solid fa-file-signature text-lg w-6 text-center"></i></a></li>
                        <li><a href="https://docs.google.com/spreadsheets/d/1AfBQh0ujEiQNq6sbkM2h3tLJ_sqdvfxi2TKHBgnlDDY/edit?pli=1&gid=422064529#gid=422064529" target="_blank" class="group flex items-center justify-end space-x-3 text-gray-400 hover:text-white transition"><span class="text-sm uppercase tracking-wide group-hover:underline text-[11px]">PILOT CALL RECORD</span><i class="fa-solid fa-file-signature text-lg w-6 text-center"></i></a></li>
                        <li><a href="https://docs.google.com/spreadsheets/d/1mN4E5cXsxGxsloWB8NGPsJMU0OIL0ANO1CgnbNSh0gU/edit?gid=1459300150#gid=1459300150" target="_blank" class="group flex items-center justify-end space-x-3 text-gray-400 hover:text-white transition"><span class="text-sm uppercase tracking-wide group-hover:underline text-[11px]">COMAT SHEET</span><i class="fa-solid fa-boxes-packing text-lg w-6 text-center"></i></a></li>
                        <li><a href="https://docs.google.com/spreadsheets/d/10LFoNKmrFMcwXQmzfbszxhQu7R8fBZrzGQFgM7tfnNg/edit?gid=1291803062#gid=1291803062" target="_blank" class="group flex items-center justify-end space-x-3 text-gray-400 hover:text-white transition"><span class="text-sm uppercase tracking-wide group-hover:underline text-[11px]">REQUEST ENS</span><i class="fa-solid fa-file-circle-check text-lg w-6 text-center"></i></a></li>
                        <li><a href="https://script.google.com/a/macros/airasia.com/s/AKfycby16qNHGNsCVo6ioxr80u_RluuHNFl9pgPZ_MEa6-PV6BXondlmRhTliokEmyBKcp0V/exec" target="_blank" class="group flex items-center justify-end space-x-3 text-gray-400 hover:text-white transition"><span class="text-sm uppercase tracking-wide group-hover:underline text-[11px]">LIST A/C FOR ENS ASSIGNMENT</span><i class="fa-solid fa-file-circle-check text-lg w-6 text-center"></i></a></li>
                        <li><a href="https://docs.google.com/spreadsheets/d/1v1NaHf5eas1atch8cM_sM0WEjcPuCdFGaw9uXMB0VVk/edit?gid=1145119591#gid=1145119591" target="_blank" class="group flex items-center justify-end space-x-3 text-gray-400 hover:text-white transition"><span class="text-sm uppercase tracking-wide group-hover:underline text-[11px]">STN MAINT SUPPORT</span><i class="fa-solid fa-screwdriver-wrench text-lg w-6 text-center"></i></a></li>
                        <li><a href="https://script.google.com/a/macros/airasia.com/s/AKfycbxwS_Nf-lcrIMJd-tO9XQPCEk0Gc1fxpwlT7DnA13c_oYmULy_ImwBv8RSTuQfCHaBq/exec" target="_blank" class="group flex items-center justify-end space-x-3 text-gray-400 hover:text-white transition"><span class="text-sm uppercase tracking-wide group-hover:underline text-[11px]">PRIORITY LIST PREPARATION</span><i class="fa-solid fa-file-signature text-lg w-6 text-center"></i></a></li>
                        <li><a href="https://docs.google.com/spreadsheets/d/1jbs6zWsTG0zDChbgdWTWRr0oAncYi6pHkqQRFLNT4oA/edit?gid=1673954076#gid=1673954076" target="_blank" class="group flex items-center justify-end space-x-3 text-gray-400 hover:text-white transition"><span class="text-sm uppercase tracking-wide group-hover:underline text-[11px]">MOC ROSTER</span><i class="fa-solid fa-file-circle-check text-lg w-6 text-center"></i></a></li>
                        
                        <li>
                            <div onclick="document.getElementById('elevade-submenu').classList.toggle('hidden'); this.querySelector('.fa-chevron-down').classList.toggle('rotate-180')" class="cursor-pointer group flex items-center justify-end space-x-3 text-gray-400 hover:text-white transition select-none">
                                <i class="fa-solid fa-chevron-down text-[10px] mr-1 opacity-50 group-hover:opacity-100 transition-transform duration-300"></i>
                                <span class="text-sm uppercase tracking-wide group-hover:underline">ELEVADE</span>
                                <i class="fa-solid fa-arrow-up-right-dots text-lg w-6 text-center"></i>
                            </div>
                            <ul id="elevade-submenu" class="hidden mt-1 space-y-1 border-r border-gray-600 pr-3 mr-2 bg-black bg-opacity-20 py-2 rounded-l-lg animate-slide-up">
                                <li><a href="https://elevade.io" target="_blank" class="block text-[11px] text-gray-400 hover:text-blue-300 text-right py-1 hover:pl-2 transition-all">HOME PAGE</a></li>
                                <li><a href="https://airasia.elevade.io/fleet/dasr/dashboard" target="_blank" class="block text-[11px] text-gray-400 hover:text-blue-300 text-right py-1 hover:pl-2 transition-all">DASR Overview</a></li>
                                <li><a href="https://airasia.elevade.io/fleet/dasr/aircraft-list" target="_blank" class="block text-[11px] text-gray-400 hover:text-blue-300 text-right py-1 hover:pl-2 transition-all">Aircraft List</a></li>
                                <li><a href="https://airasia.elevade.io/fleet/dasr/aircraft-status" target="_blank" class="block text-[11px] text-gray-400 hover:text-blue-300 text-right py-1 hover:pl-2 transition-all">MAA Maintenance Status</a></li>
                                <li><a href="https://airasia.elevade.io/fleet/dasr/aircraft-report" target="_blank" class="block text-[11px] text-gray-400 hover:text-blue-300 text-right py-1 hover:pl-2 transition-all">MAA DDML Reports</a></li>
                                <li><a href="https://airasia.elevade.io/fleet/dasr/aircraft-report-closed" target="_blank" class="block text-[11px] text-gray-400 hover:text-blue-300 text-right py-1 hover:pl-2 transition-all">Closed Aircraft Reports</a></li>
                                <li><a href="https://airasia.elevade.io/fleet/dasr/scheduled-task" target="_blank" class="block text-[11px] text-gray-400 hover:text-blue-300 text-right py-1 hover:pl-2 transition-all">Scheduled Task</a></li>
                                <li><a href="https://airasia.elevade.io/fleet/dasr/assignment-draft" target="_blank" class="block text-[11px] text-gray-400 hover:text-blue-300 text-right py-1 hover:pl-2 transition-all">Assignment Drafts</a></li>
                            </ul>
                        </li>

                        <li><a href="https://w3.airbus.com/newairbusworld" target="_blank" class="group flex items-center justify-end space-x-3 text-gray-400 hover:text-white transition"><span class="text-sm uppercase tracking-wide group-hover:underline">AIRBUS WORLD</span><i class="fa-solid fa-earth-europe text-lg w-6 text-center"></i></a></li>
                        <li><a href="https://vdiairfase.airasia.com/RDWeb/webclient/" target="_blank" class="group flex items-center justify-end space-x-3 text-gray-400 hover:text-white transition"><span class="text-sm uppercase tracking-wide group-hover:underline">AIRFASE</span><i class="fa-solid fa-jet-fighter text-lg w-6 text-center"></i></a></li>
                        <li><a href="https://redwatch.airasia.com/eops#" target="_blank" class="group flex items-center justify-end space-x-3 text-gray-400 hover:text-white transition"><span class="text-sm uppercase tracking-wide group-hover:underline">RED WATCH</span><i class="fa-solid fa-bullseye text-lg w-6 text-center"></i></a></li>
                        <li><a href="https://skyaims.airasia.com" target="_blank" class="group flex items-center justify-end space-x-3 text-gray-400 hover:text-white transition"><span class="text-sm uppercase tracking-wide group-hover:underline">AIMS</span><i class="fa-solid fa-crosshairs text-lg w-6 text-center"></i></a></li>
                        <li><a href="https://script.google.com/a/macros/airasia.com/s/AKfycbzWpwTbW9jYYO-knwIqrg4Hb5bgnlx5eJwenYRyOwUWxCtMslgtzzsgGgfdsw2RQzHg/exec" target="_blank" class="group flex items-center justify-end space-x-3 text-gray-400 hover:text-white transition"><span class="text-sm uppercase tracking-wide group-hover:underline text-[11px]">ELH OLD VERSION</span><i class="fa-solid fa-clock-rotate-left text-lg w-6 text-center"></i></a></li>
                    </ul>
                </nav>

                <div class="p-4 border-t border-gray-700 bg-black bg-opacity-30">
                    <div class="flex items-center justify-between mb-2">
                        <img id="user-photo" src="" alt="User" class="w-8 h-8 rounded-full border border-gray-500">
                        <div class="text-right">
                            <div id="user-name" class="text-xs font-bold text-white truncate max-w-[120px]">User</div>
                            <div id="user-email" class="text-[10px] text-gray-400 truncate max-w-[120px]">@airasia.com</div>
                        </div>
                    </div>
                    <button id="logout-btn" class="w-full text-xs bg-red-600 hover:bg-red-500 text-white py-1 px-2 rounded transition flex items-center justify-center">
                        <i class="fa-solid fa-right-from-bracket mr-2"></i> Logout
                    </button>
                </div>
            </div>
        </div>

        <div id="main" class="flex-1 w-full md:ml-64 transition-all duration-300 overflow-y-auto h-full">

            <section id="top" class="relative w-full min-h-[500px] flex items-center">
                <div class="absolute inset-0 z-0">
                    <img src="https://res.cloudinary.com/dzgov6mcu/image/upload/v1770126320/banner_sq0hej.jpg" alt="Banner" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-black bg-opacity-75"></div>
                </div>

                <div class="relative z-10 container mx-auto px-6 py-20 md:py-10">
                    <div class="text-center mb-8">
                        <h2 class="text-2xl md:text-4xl font-bold text-white drop-shadow-lg uppercase tracking-wider">
                            MOC <span class="text-blue-400">ENGINEERING</span> DASHBOARD
                        </h2>
                        <div class="h-1 w-24 bg-blue-500 mx-auto mt-4 rounded-full"></div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-8 gap-4 md:gap-6">
                        
                        <!-- Dash 1: DDML TODAY & YESTERDAY -->
                        <div class="dashboard-card p-3 rounded-2xl text-white relative overflow-hidden group h-[260px] flex flex-col justify-between lg:col-span-2">
                            <button onclick="toggleCardFullscreen(this)" title="Fullscreen" class="absolute top-2 right-2 text-gray-500 hover:text-white transition z-20"><i class="fa-solid fa-up-right-and-down-left-from-center text-xs"></i></button>
                            
                            <!-- Top Half: TODAY -->
                            <div class="flex flex-col relative z-10">
                                <div class="flex items-center gap-2 mb-1 pr-6">
                                    <div class="bg-blue-600 bg-opacity-40 p-1 rounded-md"><i class="fa-solid fa-clipboard-list text-blue-200 text-xs"></i></div>
                                    <span class="text-[10px] font-bold text-gray-200 uppercase tracking-widest">DDML TODAY</span>
                                    <span id="ddml-time-badge" class="ml-auto text-[8px] font-mono text-blue-300 border border-blue-500/30 px-1 py-0.5 rounded bg-blue-900/40">--:--</span>
                                </div>
                                
                                <div class="flex items-end mb-1">
                                    <div id="ddml-total" class="text-3xl font-bold text-white leading-none">--</div>
                                    <div id="ddml-total-diff" class="ml-2 mb-0.5 flex items-center"></div>
                                    <div class="text-[8px] text-gray-400 mb-0.5 ml-2 tracking-widest">TOTAL</div>
                                </div>

                                <div class="grid grid-cols-3 gap-1 text-center bg-gray-800/50 rounded-lg p-1 border border-gray-700/50">
                                    <div onclick="openDDMLModal('CAT', 'ชีต2')" class="cursor-pointer hover:bg-gray-700/80 rounded transition duration-200 group/btn py-0.5">
                                        <div class="text-[8px] text-gray-400 uppercase tracking-wider mb-0.5 group-hover/btn:text-gray-200">CAT <i class="fa-solid fa-arrow-pointer text-[6px] opacity-50 ml-0.5"></i></div>
                                        <div class="flex items-center justify-center space-x-1">
                                            <span id="ddml-cat" class="text-sm font-bold text-yellow-400 leading-none">-</span>
                                            <span id="ddml-cat-diff" class="flex items-center"></span>
                                        </div>
                                    </div>
                                    <div onclick="openDDMLModal('AMD', 'ชีต3')" class="border-l border-gray-600/50 cursor-pointer hover:bg-gray-700/80 rounded transition duration-200 group/btn py-0.5">
                                        <div class="text-[8px] text-gray-400 uppercase tracking-wider mb-0.5 group-hover/btn:text-gray-200">AMD <i class="fa-solid fa-arrow-pointer text-[6px] opacity-50 ml-0.5"></i></div>
                                        <div class="flex items-center justify-center space-x-1">
                                            <span id="ddml-amd" class="text-sm font-bold text-green-400 leading-none">-</span>
                                            <span id="ddml-amd-diff" class="flex items-center"></span>
                                        </div>
                                    </div>
                                    <div onclick="openDDMLModal('STR/FC', 'ชีต4')" class="border-l border-gray-600/50 cursor-pointer hover:bg-gray-700/80 rounded transition duration-200 group/btn py-0.5">
                                        <div class="text-[8px] text-gray-400 uppercase tracking-wider mb-0.5 group-hover/btn:text-gray-200">STR/FC <i class="fa-solid fa-arrow-pointer text-[6px] opacity-50 ml-0.5"></i></div>
                                        <div class="flex items-center justify-center space-x-1">
                                            <span id="ddml-str" class="text-sm font-bold text-red-400 leading-none">-</span>
                                            <span id="ddml-str-diff" class="flex items-center"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Divider -->
                            <div class="w-full h-px bg-gray-600/50 my-1.5 relative z-10 shrink-0"></div>

                            <!-- Bottom Half: YESTERDAY -->
                            <div class="flex flex-col relative z-10">
                                <div class="flex items-center gap-2 mb-1 pr-6">
                                    <div class="bg-gray-600 bg-opacity-40 p-1 rounded-md"><i class="fa-solid fa-clock-rotate-left text-gray-300 text-[10px]"></i></div>
                                    <span class="text-[9px] font-bold text-gray-400 uppercase tracking-widest">YESTERDAY</span>
                                    <span id="yest-time-badge" class="ml-auto text-[8px] font-mono text-gray-400 border border-gray-600/50 px-1 py-0.5 rounded bg-gray-800/50">--:--</span>
                                </div>
                                
                                <div class="flex items-end justify-between mb-1">
                                    <div class="flex items-end">
                                        <div id="yest-total" class="text-2xl font-bold text-gray-300 leading-none">--</div>
                                        <div id="yest-total-diff" class="ml-2 mb-0.5 flex items-center"></div>
                                        <div class="text-[8px] text-gray-500 mb-0.5 ml-2 tracking-widest">TOTAL</div>
                                    </div>
                                    
                                    <!-- OPENED and CLOSED container -->
                                    <div class="flex space-x-2 items-end">
                                        <div class="flex flex-col items-end">
                                            <div class="text-[7px] text-gray-500 uppercase tracking-widest mb-0.5">OPENED</div>
                                            <div class="bg-orange-500/20 border border-orange-500/30 px-1.5 py-0.5 rounded text-orange-400 font-bold text-sm leading-none" id="yest-opened">--</div>
                                        </div>
                                        <div class="flex flex-col items-end">
                                            <div class="text-[7px] text-gray-500 uppercase tracking-widest mb-0.5">CLOSED</div>
                                            <div class="bg-green-500/20 border border-green-500/30 px-1.5 py-0.5 rounded text-green-400 font-bold text-sm leading-none" id="yest-closed">--</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="grid grid-cols-3 gap-1 text-center bg-gray-800/30 rounded-lg p-1 border border-gray-700/30 opacity-80">
                                    <div>
                                        <div class="text-[8px] text-gray-500 uppercase tracking-wider mb-0.5">CAT</div>
                                        <div class="flex items-center justify-center space-x-1">
                                            <span id="yest-cat" class="text-xs font-bold text-yellow-500 leading-none">-</span>
                                            <span id="yest-cat-diff" class="flex items-center"></span>
                                        </div>
                                    </div>
                                    <div class="border-l border-gray-700/50">
                                        <div class="text-[8px] text-gray-500 uppercase tracking-wider mb-0.5">AMD</div>
                                        <div class="flex items-center justify-center space-x-1">
                                            <span id="yest-amd" class="text-xs font-bold text-green-500 leading-none">-</span>
                                            <span id="yest-amd-diff" class="flex items-center"></span>
                                        </div>
                                    </div>
                                    <div class="border-l border-gray-700/50">
                                        <div class="text-[8px] text-gray-500 uppercase tracking-wider mb-0.5">STR/FC</div>
                                        <div class="flex items-center justify-center space-x-1">
                                            <span id="yest-str" class="text-xs font-bold text-red-500 leading-none">-</span>
                                            <span id="yest-str-diff" class="flex items-center"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Dash 2 -->
                        <div class="dashboard-card p-5 rounded-2xl text-white h-[260px] flex flex-col lg:col-span-2">
                            <button onclick="toggleCardFullscreen(this)" title="Fullscreen" class="absolute top-2 right-2 text-gray-500 hover:text-white transition z-20"><i class="fa-solid fa-up-right-and-down-left-from-center text-xs"></i></button>
                            <div class="flex items-center justify-between mb-2">
                                <div class="bg-green-500 bg-opacity-20 p-2 rounded-lg"><i class="fa-solid fa-chart-line text-green-400"></i></div>
                                <span id="otp-trend" class="text-[9px] font-mono text-blue-300 px-1 border border-blue-500 rounded uppercase tracking-tighter">CONNECTING...</span>
                            </div>
                            <div class="flex-1 min-h-[140px] relative">
                                <canvas id="otpChart"></canvas>
                            </div>
                            <div class="mt-2 flex items-center justify-between text-[10px]">
                                <div class="flex items-center space-x-2">
                                    <span class="w-2 h-2 rounded-full bg-blue-400"></span><span class="text-gray-400 uppercase">OTP15</span>
                                    <span class="w-2 h-2 rounded-full bg-red-400 ml-2"></span><span class="text-gray-400 uppercase">ENG DLY</span>
                                </div>
                                <div id="otp-value" class="text-lg font-bold text-blue-400 leading-none">--.--%</div>
                            </div>
                        </div>

                        <!-- Dash 3 -->
                        <div class="dashboard-card p-5 rounded-2xl text-white h-[260px] flex flex-col relative group lg:col-span-2">
                            <div class="absolute top-2 right-2 flex space-x-2 z-20">
                                <button onclick="exportRedEyeData()" class="text-gray-500 hover:text-white transition" title="Export Data"><i class="fa-solid fa-file-export text-xs"></i></button>
                                <button onclick="toggleCardFullscreen(this)" class="text-gray-500 hover:text-white transition" title="Fullscreen"><i class="fa-solid fa-up-right-and-down-left-from-center text-xs"></i></button>
                            </div>
                            <div class="flex items-center justify-between mb-3 shrink-0 mr-10">
                                <div class="bg-purple-500 bg-opacity-20 p-2 rounded-lg flex items-center gap-2"><i class="fa-solid fa-moon text-purple-400"></i></div>
                                <span class="text-[10px] font-mono text-purple-300 uppercase tracking-widest text-right">RED EYE FLIGHT<br><span class="text-[9px] text-gray-400">04:00 - 09:00</span></span>
                            </div>
                            <div class="grid grid-cols-4 gap-1 mb-2 text-[11px] font-bold text-gray-400 border-b border-gray-600 pb-1 shrink-0">
                                <div class="text-center">REG</div><div class="text-center">FLT</div><div class="text-center">FROM</div><div class="text-center">STA</div>  
                            </div>
                            <div id="redeye-list" class="flex-1 overflow-y-auto custom-scrollbar relative">
                                <div class="absolute inset-0 flex flex-col items-center justify-center text-gray-400">
                                    <div class="loader w-4 h-4 mb-2 border-2 border-purple-400 border-t-transparent"></div>
                                    <span class="text-[10px]">Loading...</span>
                                </div>
                            </div>
                        </div>

                        <!-- Dash 4 -->
                        <div class="dashboard-card p-5 rounded-2xl text-white h-[260px] flex flex-col relative group lg:col-span-2">
                            <div class="absolute top-2 right-2 flex space-x-2 z-20">
                                <button onclick="export36HrsData()" class="text-gray-500 hover:text-white transition" title="Export Data"><i class="fa-solid fa-file-export text-xs"></i></button>
                                <button onclick="toggleCardFullscreen(this)" class="text-gray-500 hover:text-white transition" title="Fullscreen"><i class="fa-solid fa-up-right-and-down-left-from-center text-xs"></i></button>
                            </div>
                            <div class="flex items-center justify-between mb-3 shrink-0 mr-10">
                                <div class="bg-orange-500 bg-opacity-20 p-2 rounded-lg flex items-center gap-2"><i class="fa-solid fa-clock text-orange-400"></i></div>
                                <span class="text-[10px] font-mono text-orange-300 uppercase tracking-widest text-right">36 HRS CHK DUE<br><span class="text-[9px] text-gray-400">MONITORING</span></span>
                            </div>
                            <div class="grid grid-cols-3 gap-1 mb-2 text-[11px] font-bold text-gray-400 border-b border-gray-600 pb-1 shrink-0">
                                <div class="col-span-1 text-left pl-2">REG</div>
                                <div class="col-span-2 text-right pr-2">REMAINING</div>
                            </div>
                            <div id="36hrs-list" class="flex-1 overflow-y-auto custom-scrollbar relative">
                                <div class="absolute inset-0 flex flex-col items-center justify-center text-gray-400">
                                    <div class="loader w-4 h-4 mb-2 border-2 border-orange-400 border-t-transparent"></div>
                                    <span class="text-[10px]">Loading...</span>
                                </div>
                            </div>
                        </div>

                        <!-- Dash 5: New DDML Report -->
                        <div class="dashboard-card p-5 rounded-2xl text-white h-[260px] flex flex-col relative group lg:col-span-3">
                            <button onclick="toggleCardFullscreen(this)" title="Fullscreen" class="absolute top-2 right-2 text-gray-500 hover:text-white transition z-20"><i class="fa-solid fa-up-right-and-down-left-from-center text-xs"></i></button>
                            <div class="flex items-center justify-between mb-3 shrink-0 mr-10">
                                <div class="bg-indigo-500 bg-opacity-20 p-2 rounded-lg flex items-center gap-2">
                                    <i class="fa-solid fa-file-medical text-indigo-400"></i>
                                </div>
                                <span class="text-[10px] font-mono text-indigo-300 uppercase tracking-widest text-right">NEW DDML REPORT<br><span class="text-[9px] text-gray-400">LIVE FEED</span></span>
                            </div>
                            
                            <div class="flex text-[11px] font-bold text-gray-400 border-b border-gray-600 pb-1 shrink-0 space-x-1">
                                <div class="w-[16%] text-center">DATE</div>
                                <div class="w-[12%] text-center">REG</div>
                                <div class="w-[12%] text-center">DDML</div>
                                <div class="w-[12%] text-center">EXP</div>
                                <div class="flex-1 text-left pl-1">DEFECT</div>
                                <div class="w-[10%] text-center">LINK</div>
                            </div>

                            <div id="new-ddml-list" class="flex-1 overflow-y-auto custom-scrollbar relative">
                                <div class="absolute inset-0 flex flex-col items-center justify-center text-gray-400">
                                    <div class="loader w-4 h-4 mb-2 border-2 border-indigo-400 border-t-transparent"></div>
                                    <span class="text-[10px]">Loading...</span>
                                </div>
                            </div>
                        </div>

                        <!-- Dash 6: Maintenance Tasks & Hangarage -->
                        <div class="dashboard-card p-4 rounded-2xl text-white h-[260px] flex flex-row relative group lg:col-span-3 gap-2">
                            <button onclick="toggleCardFullscreen(this)" title="Fullscreen" class="absolute top-2 right-2 text-gray-400 hover:text-white transition z-20 bg-gray-800/80 p-1.5 rounded-lg shadow"><i class="fa-solid fa-up-right-and-down-left-from-center text-xs"></i></button>
                            
                            <!-- Left Side: Maintenance Tasks -->
                            <div class="w-[45%] flex flex-col border-r border-gray-600/50 pr-2">
                                <h3 class="text-[10px] font-bold text-gray-200 uppercase tracking-widest mb-2 flex items-center gap-1.5 shrink-0">
                                    <i class="fa-solid fa-screwdriver-wrench text-blue-400"></i> MAINT TASKS
                                </h3>
                                <div id="dash6-left-list" class="flex-1 overflow-y-auto custom-scrollbar pr-1 space-y-1 relative">
                                    <div class="absolute inset-0 flex flex-col items-center justify-center text-gray-400">
                                        <div class="loader w-4 h-4 mb-2 border-2 border-blue-400 border-t-transparent"></div>
                                        <span class="text-[9px]">Loading...</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Right Side: Hangarage Slot -->
                            <div class="w-[55%] flex flex-col pl-1 relative">
                                <h3 class="text-[10px] font-bold text-gray-200 uppercase tracking-widest mb-2 flex items-center gap-1.5 shrink-0">
                                    <i class="fa-solid fa-warehouse text-orange-400"></i> HANGARAGE / OMV
                                </h3>
                                <div class="flex text-[8px] font-bold text-gray-400 border-b border-gray-600 pb-1 mb-1 shrink-0 space-x-1">
                                    <div class="w-[15%] text-center">REG</div>
                                    <div class="w-[30%] text-left">TASK</div>
                                    <div class="w-[20%] text-center">DATE</div>
                                    <div class="w-[20%] text-center">C/OUT</div>
                                    <div class="w-[15%] text-center">LINE</div>
                                </div>
                                <div id="dash6-right-list" class="flex-1 overflow-y-auto custom-scrollbar pr-1 relative">
                                    <div class="absolute inset-0 flex flex-col items-center justify-center text-gray-400">
                                        <div class="loader w-4 h-4 mb-2 border-2 border-orange-400 border-t-transparent"></div>
                                        <span class="text-[9px]">Loading...</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Dash 7 -->
                        <div class="dashboard-card p-5 rounded-2xl text-white h-[260px] flex flex-col relative group border-t-4 border-t-blue-500 lg:col-span-2">
                            <button onclick="toggleCardFullscreen(this)" title="Fullscreen" class="absolute top-2 right-2 text-gray-500 hover:text-white transition z-20"><i class="fa-solid fa-up-right-and-down-left-from-center text-xs"></i></button>
                            <div class="flex items-center justify-between mb-2 shrink-0 mr-6">
                                <div class="bg-blue-500 bg-opacity-20 p-2 rounded-lg flex items-center gap-2"><i class="fa-solid fa-plane-up text-blue-400"></i></div>
                                <span class="text-[10px] font-mono text-blue-300 uppercase tracking-widest text-right">COCKPIT WINDOW<br><span class="text-[9px] text-gray-400">MONITORING</span></span>
                            </div>
                            
                            <div class="flex-1 flex flex-col justify-center space-y-2 relative">
                                <div id="cockpit-loading" class="absolute inset-0 flex flex-col items-center justify-center bg-gray-800 bg-opacity-90 z-10 rounded-lg">
                                    <div class="loader w-4 h-4 mb-2 border-2 border-blue-400 border-t-transparent"></div>
                                    <span class="text-[10px] text-gray-400">Loading...</span>
                                </div>
                                <div class="flex justify-between items-center border-b border-gray-600/50 pb-1">
                                    <span class="text-xs text-gray-400 font-bold uppercase">Under Monitoring</span>
                                    <span id="cw-total" class="text-xl font-bold text-white">--</span>
                                </div>
                                <div class="flex justify-between items-center border-b border-gray-600/50 pb-1">
                                    <span class="text-[10px] text-gray-400 uppercase">Normal</span>
                                    <span id="cw-normal" class="text-sm font-bold text-green-400">--</span>
                                </div>
                                <div class="flex justify-between items-center border-b border-gray-600/50 pb-1">
                                    <span class="text-[10px] text-gray-400 uppercase">Observation</span>
                                    <span id="cw-obs" class="text-sm font-bold text-yellow-400">--</span>
                                </div>
                                <div class="flex justify-between items-center border-b border-gray-600/50 pb-1">
                                    <span class="text-[10px] text-gray-400 uppercase">Critical</span>
                                    <span id="cw-crit" class="text-sm font-bold text-red-400">--</span>
                                </div>
                            </div>

                            <a href="https://script.google.com/a/macros/airasia.com/s/AKfycbxvislr4mcYrl6og6M-InSr4xpuSpgTBCD7sGgkwLlmui9TJCLBnM-2vL9ER_njUMm5/exec" target="_blank" class="mt-3 w-full bg-green-600 hover:bg-green-500 text-white text-[10px] font-bold py-2 rounded text-center transition shadow-lg border border-green-500/50 uppercase tracking-wider block">
                                MORE INFO
                            </a>
                        </div>

                        <!-- Oil Consumption -->
                        <div class="col-span-1 md:col-span-2 lg:col-span-8 mt-2">
                            <div class="dashboard-card rounded-2xl overflow-hidden border border-gray-700/50 shadow-2xl relative group flex flex-col h-[600px]">
                                <button onclick="toggleCardFullscreen(this)" title="Fullscreen" class="absolute top-3 right-10 text-gray-500 hover:text-white transition z-20"><i class="fa-solid fa-up-right-and-down-left-from-center text-xs"></i></button>
                                <div class="px-5 py-3 border-b border-gray-700/50 flex items-center justify-between bg-gradient-to-r from-gray-800/80 to-transparent backdrop-blur-md">
                                    <div class="flex items-center gap-3">
                                        <div class="bg-blue-600/20 p-2 rounded-lg border border-blue-500/20 shadow-[0_0_10px_rgba(59,130,246,0.2)]">
                                            <i class="fa-solid fa-chart-area text-blue-400 text-sm"></i>
                                        </div>
                                        <div class="flex flex-col">
                                            <h3 class="text-xs font-bold text-white uppercase tracking-widest flex items-center gap-2">
                                                Oil Consumption Trends
                                                <span class="px-1.5 py-0.5 rounded text-[8px] bg-green-500/20 text-green-400 border border-green-500/30">LIVE</span>
                                            </h3>
                                            <span class="text-[9px] text-gray-400 font-mono">SOURCE: LOOKER STUDIO</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2 mr-10">
                                        <a href="https://lookerstudio.google.com/reporting/b4e0321f-4cab-48f8-ba96-57ccc3fd29d9/page/tEnnC" target="_blank" class="p-2 text-gray-400 hover:text-white hover:bg-white/10 rounded-lg transition-all" title="Open Full Screen">
                                            <i class="fa-solid fa-up-right-from-square text-xs"></i>
                                        </a>
                                    </div>
                                </div>
                                <div class="relative flex-1 bg-[#1a1d21]">
                                    <iframe 
                                        width="100%" 
                                        height="100%" 
                                        src="https://lookerstudio.google.com/embed/reporting/b4e0321f-4cab-48f8-ba96-57ccc3fd29d9/page/tEnnC" 
                                        frameborder="0" 
                                        style="border:0;" 
                                        allowfullscreen 
                                        sandbox="allow-storage-access-by-user-activation allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox"
                                        class="absolute inset-0 w-full h-full opacity-95 hover:opacity-100 transition-opacity"
                                    ></iframe>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="projects" class="pt-8 pb-20 bg-gray-100">
                <div class="container mx-auto px-6 max-w-7xl">
                    <header class="mb-10 border-b pb-4">
                        <h2 class="text-3xl font-bold text-gray-800"><i class="fa-solid fa-shuttle-space mr-2 text-gray-400"></i> Projects</h2>
                    </header>

                    <div id="project-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        
                        <article class="bg-white rounded-lg shadow-md hover:shadow-xl transition relative group">
                            <div onclick="toggleProjectMenu('menu-delay')" class="cursor-pointer block h-64 overflow-hidden rounded-t-lg outline-none relative">
                                <img src="https://res.cloudinary.com/dzgov6mcu/image/upload/v1770579512/28E6D130-563F-4EDD-A48F-75425AFC040A_emdltk.png" class="w-full h-full object-cover transform transition duration-500 hover:scale-110" alt="DELAY">
                                <div id="menu-delay" onclick="event.stopPropagation()" class="hidden md:group-hover:flex absolute bottom-0 left-0 w-full h-full bg-black bg-opacity-85 px-6 animate-slide-up flex-col justify-center items-center space-y-2">
                                    <a href="https://docs.google.com/spreadsheets/d/15hzmr796muPK4Qg24eo1PDX9r8MGYwcEa_wWEOaTYsI/edit?pli=1&gid=1575409481#gid=1575409481" target="_blank" class="w-full text-center py-2 px-4 bg-green-600 text-white rounded hover:bg-green-500 transition font-semibold shadow-md text-sm border border-green-400"><i class="fa-brands fa-google mr-2"></i> GOOGLE SHEET DATA</a>
                                    <a href="https://docs.google.com/spreadsheets/d/1-aHRMHSciihQUT8CnDdZWIQo4_KlSUAZs3fcoYyDbNs/edit?gid=1650993066#gid=1650993066" target="_blank" class="w-full text-center py-2 px-4 bg-purple-600 text-white rounded hover:bg-purple-500 transition font-semibold shadow-md text-sm border border-purple-400"><i class="fa-solid fa-file-excel mr-2"></i> SHEET (MOCF/03 REV02)</a>
                                    <a href="https://drive.google.com/file/d/1wcVMkCYR9xSXM9DaDJDYv9GZU_nrBNoQ/view?usp=sharing" target="_blank" class="w-full text-center py-2 px-4 bg-blue-600 text-white rounded hover:bg-blue-500 transition font-semibold shadow-md text-sm border border-blue-400"><i class="fa-solid fa-file-contract mr-2"></i> TUTORIAL VDO</a> 
                                </div>
                            </div>
                            <div class="p-6"><h3 class="font-bold text-lg">DELAY CAPTURE & EDSR DRAFT</h3></div>
                        </article>

                        <article class="bg-white rounded-lg shadow-md hover:shadow-xl transition relative group">
                            <div onclick="toggleProjectMenu('menu-36hrs')" class="cursor-pointer block h-64 overflow-hidden rounded-t-lg outline-none relative">
                                <img src="https://res.cloudinary.com/dzgov6mcu/image/upload/v1770579771/AE0A040A-3C08-4A44-A6A1-B5EEAC0EA3CA_z67mvw.png" class="w-full h-full object-cover transform transition duration-500 hover:scale-110" alt="36HRS">
                                <div id="menu-36hrs" onclick="event.stopPropagation()" class="hidden md:group-hover:flex absolute bottom-0 left-0 w-full h-full bg-black bg-opacity-85 px-6 animate-slide-up flex-col justify-center items-center space-y-2">
                                    <a href="https://script.google.com/a/macros/airasia.com/s/AKfycbwtfXs0ElPqbXRe47Q44D9YER3op9Mj_ToAyPtgi-To_6pVrAJtId-2BpVMsWGRNeYg/exec" target="_blank" class="w-full text-center py-2 px-4 bg-orange-600 text-white rounded hover:bg-orange-500 transition font-semibold shadow-md text-sm border border-orange-400"><i class="fa-solid fa-calendar-days mr-2"></i> PLANNER + GANTT</a>
                                </div>
                            </div>
                            <div class="p-6"><h3 class="font-bold text-lg">36HRS & WEEKLY</h3></div>
                        </article>

                        <article class="bg-white rounded-lg shadow-md hover:shadow-xl transition relative group">
                            <div onclick="toggleProjectMenu('menu-oil-dash')" class="cursor-pointer block h-64 overflow-hidden rounded-t-lg outline-none relative">
                                <img src="https://res.cloudinary.com/dzgov6mcu/image/upload/v1770609060/Screenshot_2569-02-09_at_11.50.46_vztw2h.png" class="w-full h-full object-cover transform transition duration-500 hover:scale-110" alt="OIL">
                                <div id="menu-oil-dash" onclick="event.stopPropagation()" class="hidden md:group-hover:flex absolute bottom-0 left-0 w-full h-full bg-black bg-opacity-85 px-6 animate-slide-up flex-col justify-center items-center space-y-2">
                                    <a href="https://lookerstudio.google.com/u/0/reporting/b4e0321f-4cab-48f8-ba96-57ccc3fd29d9/page/tEnnC" target="_blank" class="w-full text-center py-2 px-4 bg-orange-600 text-white rounded hover:bg-orange-500 transition font-semibold shadow-md text-sm border border-orange-400"><i class="fa-solid fa-calendar-days mr-2"></i> MONITORING DASHBOARD</a>
                                </div>
                            </div>
                            <div class="p-6"><h3 class="font-bold text-lg">HIGH OIL CONSUMPTION MONITOR</h3></div>
                        </article>

                        <article class="bg-white rounded-lg shadow-md hover:shadow-xl transition relative group">
                            <div onclick="toggleProjectMenu('menu-cabin')" class="cursor-pointer block h-64 overflow-hidden rounded-t-lg outline-none relative">
                                <img src="https://res.cloudinary.com/dzgov6mcu/image/upload/v1770649252/Screenshot_2569-02-09_at_23.00.30_h0bm9t.png" class="w-full h-full object-cover transform transition duration-500 hover:scale-110" alt="CABIN">
                                <div id="menu-cabin" onclick="event.stopPropagation()" class="hidden md:group-hover:flex absolute bottom-0 left-0 w-full h-full bg-black bg-opacity-85 px-6 animate-slide-up flex-col justify-center items-center space-y-2">
                                    <a href="https://sites.google.com/airasia.com/a320cabindrawing/" target="_blank" class="w-full text-center py-2 px-4 bg-orange-600 text-white rounded hover:bg-orange-500 transition font-semibold shadow-md text-sm border border-orange-400"><i class="fa-solid fa-calendar-days mr-2"></i> A320 FAM CABIN DRAWING</a>
                                </div>
                            </div>
                            <div class="p-6"><h3 class="font-bold text-lg">A320 FAM CABIN DRAWING</h3></div>
                        </article>
                        
                        <article class="bg-white rounded-lg shadow-md hover:shadow-xl transition relative group">
                            <div onclick="toggleProjectMenu('menu-cockpit')" class="cursor-pointer block h-64 overflow-hidden rounded-t-lg outline-none relative">
                                <img src="https://res.cloudinary.com/dzgov6mcu/image/upload/v1770580017/Screenshot_2569-02-09_at_03.46.35_u7deut.png" class="w-full h-full object-cover transform transition duration-500 hover:scale-110" alt="COCKPIT">
                                <div id="menu-cockpit" onclick="event.stopPropagation()" class="hidden md:group-hover:flex absolute bottom-0 left-0 w-full h-full bg-black bg-opacity-85 px-6 animate-slide-up flex-col justify-center items-center space-y-2">
                                    <a href="https://script.google.com/a/macros/airasia.com/s/AKfycbzANRaZP38ZfMW-u285DYCOfbzZW6446bk4JoiVNSYCkPc3c5XTDXWvKgXRQ4XuesMd/exec" target="_blank" class="w-full text-center py-2 px-4 bg-blue-600 text-white rounded hover:bg-blue-500 transition font-semibold shadow-md text-sm border border-blue-400"><i class="fa-solid fa-file-contract mr-2"></i> REPORT FORM</a>
                                    <a href="https://script.google.com/a/macros/airasia.com/s/AKfycbxMPlhgrnzNndvr7tJfU2T2gd0o_ZjxiOcy8rHvk5RDbMp5YDpGThhEis13qZuN_WJuIg/exec" target="_blank" class="w-full text-center py-2 px-4 bg-teal-600 text-white rounded hover:bg-teal-500 transition font-semibold shadow-md text-sm border border-teal-400"><i class="fa-solid fa-eye mr-2"></i> VIEW REPORT</a>
                                    <a href="https://script.google.com/a/macros/airasia.com/s/AKfycbxvislr4mcYrl6og6M-InSr4xpuSpgTBCD7sGgkwLlmui9TJCLBnM-2vL9ER_njUMm5/exec" target="_blank" class="w-full text-center py-2 px-4 bg-purple-600 text-white rounded hover:bg-purple-500 transition font-semibold shadow-md text-sm border border-purple-400"><i class="fa-solid fa-chart-line mr-2"></i> SUMMARY BOARD</a>
                                    <a href="https://docs.google.com/spreadsheets/d/16AUNk-n2xzs-HE3nQJp52QLkPjyxOfPh3JNNrSrz-GM/edit?usp=sharing" target="_blank" class="w-full text-center py-2 px-4 bg-green-600 text-white rounded hover:bg-green-500 transition font-semibold shadow-md text-sm border border-green-400"><i class="fa-brands fa-google mr-2"></i> GOOGLE SHEET DATA</a>
                                </div>
                            </div>
                            <div class="p-6"><h3 class="font-bold text-lg">COCKPIT WINDOWS</h3></div>
                        </article>

                        <article class="bg-white rounded-lg shadow-md hover:shadow-xl transition relative group">
                            <div onclick="toggleProjectMenu('menu-fuel')" class="cursor-pointer block h-64 overflow-hidden rounded-t-lg outline-none relative">
                                <img src="https://res.cloudinary.com/dzgov6mcu/image/upload/v1770535177/ChatGPT_Image_Feb_8_2026_at_03_17_29_PM_tmbe9x.png" class="w-full h-full object-cover transform transition duration-500 hover:scale-110" alt="FUEL">
                                <div id="menu-fuel" onclick="event.stopPropagation()" class="hidden md:group-hover:flex absolute bottom-0 left-0 w-full h-full bg-black bg-opacity-85 px-6 animate-slide-up flex-col justify-center items-center space-y-2">
                                    <a href="https://script.google.com/a/macros/airasia.com/s/AKfycbz1bMuKjwUm7hG6z2nRfc5kTYVAaRkjS6Lj-6wZueOme3OgqKctYPQxYegZJD4G4h8_/exec" target="_blank" class="w-full text-center py-2 px-4 bg-blue-600 text-white rounded hover:bg-blue-500 transition font-semibold shadow-md text-sm border border-blue-400"><i class="fa-solid fa-file-contract mr-2"></i> REPORT FORM</a>
                                    <a href="https://script.google.com/a/macros/airasia.com/s/AKfycbxM3fGeCoxjC7bhZxb2jJZu3hnkpWRRhRqBI4mR8CeWAwtUNe8mEksMxKStD5ZuYPfzPg/exec" target="_blank" class="w-full text-center py-2 px-4 bg-purple-600 text-white rounded hover:bg-purple-500 transition font-semibold shadow-md text-sm border border-purple-400"><i class="fa-solid fa-chart-line mr-2"></i> SUMMARY BOARD</a>
                                    <a href="https://docs.google.com/spreadsheets/d/1dERSv5F9Vz-bQv-010ResmCJ7-kI8zggnG3aqFXZ_1o/edit?gid=1917141521#gid=1917141521" target="_blank" class="w-full text-center py-2 px-4 bg-green-600 text-white rounded hover:bg-green-500 transition font-semibold shadow-md text-sm border border-green-400"><i class="fa-brands fa-google mr-2"></i> GOOGLE SHEET DATA</a>
                                    <a href="https://docs.google.com/spreadsheets/d/1ct0ydAJXArnnMRaFuYK5H5kbKYhGO7NABT5dHkY1rJg/edit?gid=0#gid=0" target="_blank" class="w-full text-center py-2 px-4 bg-gray-600 text-white rounded hover:bg-gray-500 transition font-semibold shadow-md text-sm border border-gray-400"><i class="fa-solid fa-database mr-2"></i> TODAY's back-up</a>
                                    <a href="https://script.google.com/a/macros/airasia.com/s/AKfycbwUcSU5dHqMmb8MBv8z0z2tzjRHcgII1V9DFV6tGAsc8e6Pu8Ylb7RdR-JHrLkJzuKrIA/exec" target="_blank" class="w-full text-center py-2 px-4 bg-cyan-600 text-white rounded hover:bg-cyan-500 transition font-semibold shadow-md text-sm border border-cyan-400"><i class="fa-solid fa-plane-arrival mr-2"></i> KUL Bay Planner</a>
                                </div>
                            </div>
                            <div class="p-6"><h3 class="font-bold text-lg">FUEL DRAIN MONITOR</h3></div>
                        </article>

                        <article class="bg-white rounded-lg shadow-md hover:shadow-xl transition relative group">
                            <div onclick="toggleProjectMenu('menu-oil')" class="cursor-pointer block h-64 overflow-hidden rounded-t-lg outline-none relative">
                                <img src="https://res.cloudinary.com/dzgov6mcu/image/upload/v1770534640/ChatGPT_Image_Feb_8_2026_at_03_09_18_PM_mchwpu.png" class="w-full h-full object-cover transform transition duration-500 hover:scale-110" alt="OIL">
                                <div id="menu-oil" onclick="event.stopPropagation()" class="hidden md:group-hover:flex absolute bottom-0 left-0 w-full h-full bg-black bg-opacity-85 px-6 animate-slide-up flex-col justify-center items-center space-y-2">
                                    <a href="https://script.google.com/a/macros/airasia.com/s/AKfycbyjC5jPbWoJZP_5IxtXeOIHXLxPKPW0EX5bkC3d7bC-6nLCE_EpvItLB61PcrX2pXt8/exec" target="_blank" class="w-full text-center py-2 px-4 bg-blue-600 text-white rounded hover:bg-blue-500 transition font-semibold shadow-md text-sm border border-blue-400"><i class="fa-solid fa-file-contract mr-2"></i> MAA REPORT FORM</a>
                                    <a href="https://script.google.com/a/macros/airasia.com/s/AKfycbweXIls6u4khtDxFAZr3rA7jGIBkp1qQmeB5iy8accP0eyhmAOzpaoVlAqBxoME3faL/exec" target="_blank" class="w-full text-center py-2 px-4 bg-blue-600 text-white rounded hover:bg-blue-500 transition font-semibold shadow-md text-sm border border-blue-400"><i class="fa-solid fa-file-contract mr-2"></i> TAA REPORT FORM</a>
                                    <a href="https://docs.google.com/spreadsheets/d/1vB6g-fYUmTPurOeD6uflAi-25IANUxqArMZQv3m0tU0/edit?gid=0#gid=0" target="_blank" class="w-full text-center py-2 px-4 bg-green-600 text-white rounded hover:bg-green-500 transition font-semibold shadow-md text-sm border border-green-400"><i class="fa-brands fa-google mr-2"></i> MAA GOOGLE SHEET DATA</a>
                                    <a href="https://docs.google.com/spreadsheets/d/1FMlo_qZ-Aon1iSTPSThb3fEEuGJewM8s3NoIP8eXCL8/edit?gid=0#gid=0" target="_blank" class="w-full text-center py-2 px-4 bg-green-600 text-white rounded hover:bg-green-500 transition font-semibold shadow-md text-sm border border-green-400"><i class="fa-brands fa-google mr-2"></i> TAA GOOGLE SHEET DATA</a>
                                </div>
                            </div>
                            <div class="p-6"><h3 class="font-bold text-lg">ENG OIL SERVICING</h3></div>
                        </article>

                        <article class="bg-white rounded-lg shadow-md hover:shadow-xl transition relative group">
                            <div onclick="toggleProjectMenu('menu-starter')" class="cursor-pointer block h-64 overflow-hidden rounded-t-lg outline-none relative">
                                <img src="https://res.cloudinary.com/dzgov6mcu/image/upload/v1770586375/starter_b3obnt.png" class="w-full h-full object-cover transform transition duration-500 hover:scale-110" alt="STARTER">
                                <div id="menu-starter" onclick="event.stopPropagation()" class="hidden md:group-hover:flex absolute bottom-0 left-0 w-full h-full bg-black bg-opacity-85 px-6 animate-slide-up flex-col justify-center items-center space-y-2">
                                    
                                    <a href="https://script.google.com/a/macros/airasia.com/s/AKfycbxB33Fwh9gdmOniqlOsmCbjGRl4WYxW5963GMvudMfrt1ZHyeN-hqPFec1BeRH8vAgd/exec" target="_blank" class="w-full text-center py-2 px-4 bg-blue-600 text-white rounded hover:bg-blue-500 transition font-semibold shadow-md text-sm border border-blue-400"><i class="fa-solid fa-file-contract mr-2"></i> REPORT FORM</a>
                                    
                                    <a href="https://docs.google.com/spreadsheets/d/1VxuFhBMkuXdi1N_JncPG0do8P2Hn4mxbr1PdWkQMPC0/edit?gid=1042130743#gid=1042130743" target="_blank" class="w-full text-center py-2 px-4 bg-green-600 text-white rounded hover:bg-green-500 transition font-semibold shadow-md text-sm border border-green-400"><i class="fa-brands fa-google mr-2"></i> GOOGLE SHEET DATA</a>
                                    <a href="https://lookerstudio.google.com/u/0/reporting/0a50c273-b14c-49cf-84c8-551d0f2cb4c3/page/dwbcF" target="_blank" class="w-full text-center py-2 px-4 bg-purple-600 text-white rounded hover:bg-purple-500 transition font-semibold shadow-md text-sm border border-purple-400"><i class="fa-solid fa-chart-line mr-2"></i> SUMMARY BOARD</a>
                                </div>
                            </div>
                            <div class="p-6"><h3 class="font-bold text-lg">PNEUMATIC STARTER</h3></div>
                        </article>

                        <article class="bg-white rounded-lg shadow-md hover:shadow-xl transition relative group">
                            <div onclick="toggleProjectMenu('menu-spinner')" class="cursor-pointer block h-64 overflow-hidden rounded-t-lg outline-none relative">
                                <img src="https://res.cloudinary.com/dzgov6mcu/image/upload/v1770587097/Screenshot_2569-02-09_at_05.44.39_y4hr6c.png" class="w-full h-full object-cover transform transition duration-500 hover:scale-110" alt="SPINNER">
                                <div id="menu-spinner" onclick="event.stopPropagation()" class="hidden md:group-hover:flex absolute bottom-0 left-0 w-full h-full bg-black bg-opacity-85 px-6 animate-slide-up flex-col justify-center items-center space-y-2">
                                    <a href="https://script.google.com/a/macros/airasia.com/s/AKfycbxzBqHE0vcoXpWV4NI1ba3H9pTS4IRzvxiuuVG-qEoE/dev" target="_blank" class="w-full text-center py-2 px-4 bg-blue-600 text-white rounded hover:bg-blue-500 transition font-semibold shadow-md text-sm border border-blue-400"><i class="fa-solid fa-file-contract mr-2"></i> REPORT FORM</a>
                                    <a href="https://script.google.com/a/macros/airasia.com/s/AKfycbx3XdGe19vjxDN91kZ3I2owOJWmR_XFzt4uLH3djGC0zU4Ru5iZVxYq0vFPJtE0daQt8w/exec" target="_blank" class="w-full text-center py-2 px-4 bg-teal-600 text-white rounded hover:bg-teal-500 transition font-semibold shadow-md text-sm border border-teal-400"><i class="fa-solid fa-eye mr-2"></i> VIEW REPORT</a>
                                    <a href="https://docs.google.com/spreadsheets/d/1FYK35P9TaySA-4A8F5t04m3kTTaCeBIwJgDa874JKFg/edit?usp=sharing" target="_blank" class="w-full text-center py-2 px-4 bg-green-600 text-white rounded hover:bg-green-500 transition font-semibold shadow-md text-sm border border-green-400"><i class="fa-brands fa-google mr-2"></i> MAIN GG SHEET</a>
                                </div>
                            </div>
                            <div class="p-6"><h3 class="font-bold text-lg">ENG SPINNER CONE</h3></div>
                        </article>

                    </div>
                </div>
            </section>

            <footer class="bg-gray-200 py-6 text-center text-xs text-gray-500">
                &copy; jack & sonic. | Powered by MOC Tech
            </footer>
        </div>
    </div>

    <script type="module">
        // Import Firebase Functions including Redirect
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, signInWithRedirect, getRedirectResult, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        
        // [1] FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyBoHj4s99iMQLKKT8ZZHD4uTugLXlQRxWg",
            authDomain: "maa-moc.firebaseapp.com",
            projectId: "maa-moc",
            storageBucket: "maa-moc.firebasestorage.app",
            messagingSenderId: "1025979944090",
            appId: "1:1025979944090:web:4e4408870e740fa34ba323",
            measurementId: "G-77MC6DQX0T"
        };

        // Initialize Firebase
        let app, auth, provider;
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            provider = new GoogleAuthProvider();
            provider.setCustomParameters({ prompt: 'select_account' }); 
        } catch (e) {
            console.error("Firebase Init Error:", e);
        }

        // DOM Elements
        const loginScreen = document.getElementById('login-screen');
        const appContent = document.getElementById('app-content');
        const loginBtn = document.getElementById('google-login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const loadingIndicator = document.getElementById('loading-indicator');
        const loadingSubtext = document.getElementById('loading-subtext');
        const errorDiv = document.getElementById('login-error');
        const errorMsg = document.getElementById('error-msg');
        
        // User Profile Elements
        const userPhoto = document.getElementById('user-photo');
        const userName = document.getElementById('user-name');
        const userEmail = document.getElementById('user-email');

        // [2] LOGIN FUNCTION with Safari Fallback
        loginBtn.addEventListener('click', async () => {
            errorDiv.classList.add('hidden');
            loginBtn.classList.add('hidden');
            loadingIndicator.classList.remove('hidden');
            loadingSubtext.innerText = "Connecting to Google...";

            try {
                // Try Popup First
                const result = await signInWithPopup(auth, provider);
                const user = result.user;
                validateUser(user);
            } catch (error) {
                console.error("Popup Login Error:", error);
                
                // Check if it's the specific Safari/Mobile issue
                if (error.code === 'auth/popup-closed-by-user' || error.code === 'auth/popup-blocked' || error.code === 'auth/cancelled-popup-request') {
                    loadingSubtext.innerText = "Enabling Safari compatibility mode...";
                    // Fallback to Redirect
                    try {
                        await signInWithRedirect(auth, provider);
                        // The page will redirect, so no code below this line will run immediately
                    } catch (redirectError) {
                        console.error("Redirect Login Error:", redirectError);
                        showLoginError(redirectError.message);
                    }
                } else {
                    showLoginError(error.message);
                }
            }
        });

        // [3] CHECK REDIRECT RESULT (For Safari/Mobile return)
        // This runs when the page loads after a redirect login
        if(auth) {
            getRedirectResult(auth)
                .then((result) => {
                    if (result) {
                        const user = result.user;
                        validateUser(user);
                    }
                }).catch((error) => {
                    console.error("Redirect Result Error:", error);
                    showLoginError(error.message);
                });
        }

        // [4] VALIDATION LOGIC
        function validateUser(user) {
            if (user.email.endsWith('@airasia.com')) {
                showApp(user);
            } else {
                signOut(auth);
                showLoginError("Access Denied: Only @airasia.com accounts are allowed.");
            }
        }

        function showApp(user) {
            userName.innerText = user.displayName || "User";
            userEmail.innerText = user.email;
            if(user.photoURL) userPhoto.src = user.photoURL;

            loginScreen.classList.add('hidden');
            appContent.classList.remove('hidden');
            appContent.classList.add('flex');
            
            if(!window.chartInterval) {
                refreshAllData();
                window.chartInterval = setInterval(refreshAllData, 60000);
            }
        }

        function refreshAllData() {
            fetchOTPData();
            fetchDDMLData();
            fetchRedEyeData();
            fetch36HrsData();
            fetchCockpitWindowData();
            fetchNewDDMLReport();
            fetchDash6Data(); // Added Dash 6
        }

        function showLoginError(message) {
            loadingIndicator.classList.add('hidden');
            loginBtn.classList.remove('hidden');
            errorDiv.classList.remove('hidden');
            errorMsg.innerText = message;
        }

        // [5] AUTH STATE OBSERVER
        if(auth) {
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    if (user.email.endsWith('@airasia.com')) {
                        showApp(user);
                    } else {
                        signOut(auth);
                    }
                } else {
                    loginScreen.classList.remove('hidden');
                    appContent.classList.add('hidden');
                    appContent.classList.remove('flex');
                }
            });
        }

        // [6] LOGOUT FUNCTION
        logoutBtn.addEventListener('click', () => {
            if(auth) {
                signOut(auth).then(() => {
                    location.reload();
                }).catch((error) => {
                    console.error('Logout Error:', error);
                    location.reload();
                });
            } else {
                location.reload();
            }
        });

        // --- DASHBOARD UI FUNCTIONS ---
        
        window.toggleCardFullscreen = function(btn) {
            const card = btn.closest('.dashboard-card');
            const icon = btn.querySelector('i');
            
            if (card.classList.contains('card-fullscreen')) {
                card.classList.remove('card-fullscreen');
                // เปลี่ยนไอคอนกลับเป็นลูกศรชี้ออก
                icon.classList.remove('fa-down-left-and-up-right-to-center');
                icon.classList.add('fa-up-right-and-down-left-from-center');
                document.body.style.overflow = '';
            } else {
                card.classList.add('card-fullscreen');
                // เปลี่ยนไอคอนเป็นลูกศรชี้เข้าเมื่อเต็มจอ
                icon.classList.remove('fa-up-right-and-down-left-from-center');
                icon.classList.add('fa-down-left-and-up-right-to-center');
                document.body.style.overflow = 'hidden';
            }
        }

        // Mobile Menu
        const menuBtn = document.getElementById('mobile-menu-btn');
        const sidebar = document.getElementById('header');
        menuBtn.addEventListener('click', () => sidebar.classList.toggle('-translate-x-full'));
        
        window.closeMobileMenu = function() { 
            if (window.innerWidth < 768) sidebar.classList.add('-translate-x-full');
        }

        // Toggle Project Menu
        window.toggleProjectMenu = function(menuId) {
            if (window.innerWidth >= 768) return;
            const menu = document.getElementById(menuId);
            if (!menu) return;
            
            const allMenus = document.querySelectorAll('[id^="menu-"]');
            allMenus.forEach(m => {
                if (m.id !== menuId) {
                    m.classList.add('hidden');
                    m.classList.remove('flex');
                }
            });
            menu.classList.toggle('hidden');
            menu.classList.toggle('flex');
        }

        // --- EXPORT FUNCTIONALITY ---
        window.closeExportModal = function() {
            document.getElementById('export-modal').classList.add('hidden');
        };

        // --- DDML DETAILS MODAL FUNCTIONALITY ---
        window.openDDMLModal = function(category, sheetName) {
            document.getElementById('ddml-modal-title').innerText = `DDML TODAY - ${category} Details`;
            document.getElementById('ddml-details-modal').classList.remove('hidden');
            const tbody = document.getElementById('ddml-modal-tbody');
            tbody.innerHTML = `
                <tr>
                    <td colspan="5" class="text-center py-8">
                        <div class="flex flex-col items-center justify-center text-gray-400">
                            <div class="loader mb-2"></div>
                            <span class="text-xs">Loading ${category} data...</span>
                        </div>
                    </td>
                </tr>
            `;
            fetchDDMLDetails(sheetName);
        };

        window.closeDDMLModal = function() {
            document.getElementById('ddml-details-modal').classList.add('hidden');
        };

        async function fetchDDMLDetails(sheetName) {
            const SHEET_ID = '1D9ed8aGAIWbf_MmfN_Lm4b2s9ZkBETnaQ6u06gobil0';
            const URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${sheetName}&headers=1`;
            const tbody = document.getElementById('ddml-modal-tbody');

            try {
                const res = await fetch(URL, { credentials: 'omit' });
                if (!res.ok) throw new Error(`HTTP Status: ${res.status}`);
                const text = await res.text();
                
                let jsonText = '';
                const jsonMatch = text.match(/google\.visualization\.Query\.setResponse\((.*)\);/);
                if (jsonMatch && jsonMatch[1]) {
                    jsonText = jsonMatch[1];
                } else if (text.startsWith("/*O_o*/")) {
                    jsonText = text.substring(47).slice(0, -2);
                } else {
                    jsonText = text;
                }
                
                const json = JSON.parse(jsonText);
                let html = '';
                
                if (json.table && json.table.rows.length > 0) {
                    json.table.rows.forEach(row => {
                        const r = row.c;
                        if (!r) return;
                        
                        // Mapping columns: A=0(Reg), B=1(Desc), C=2(DDML No), D=3(Raised), E=4(Expiry)
                        const reg = r[0] ? (r[0].f || r[0].v || '') : '';
                        const desc = r[1] ? (r[1].f || r[1].v || '') : '';
                        const ddmlNo = r[2] ? (r[2].f || r[2].v || '') : '';
                        
                        // Handle Date formatting for Raised (Col D) and Expiry (Col E)
                        let raised = '';
                        if (r[3]) {
                            if (r[3].f) raised = r[3].f;
                            else if (typeof r[3].v === 'string' && r[3].v.startsWith('Date(')) {
                                const parts = r[3].v.match(/\d+/g);
                                if (parts) {
                                    const d = new Date(parts[0], parts[1], parts[2]);
                                    raised = `${String(d.getDate()).padStart(2, '0')}/${String(d.getMonth() + 1).padStart(2, '0')}/${String(d.getFullYear()).slice(-2)}`;
                                }
                            } else raised = r[3].v || '';
                        }
                        
                        let expiry = '';
                        if (r[4]) {
                            if (r[4].f) expiry = r[4].f;
                            else if (typeof r[4].v === 'string' && r[4].v.startsWith('Date(')) {
                                const parts = r[4].v.match(/\d+/g);
                                if (parts) {
                                    const d = new Date(parts[0], parts[1], parts[2]);
                                    expiry = `${String(d.getDate()).padStart(2, '0')}/${String(d.getMonth() + 1).padStart(2, '0')}/${String(d.getFullYear()).slice(-2)}`;
                                }
                            } else expiry = r[4].v || '';
                        }

                        // Skip completely empty rows
                        if (!reg && !desc && !ddmlNo) return;

                        html += `
                            <tr class="border-b border-gray-700/50 hover:bg-white/5 transition duration-150">
                                <td class="px-3 py-3 text-xs font-mono font-bold text-orange-300 text-center align-top whitespace-nowrap">${reg}</td>
                                <td class="px-3 py-3 text-xs text-gray-200 text-left align-top leading-relaxed">${desc}</td>
                                <td class="px-3 py-3 text-xs font-mono text-blue-300 text-center align-top whitespace-nowrap">${ddmlNo}</td>
                                <td class="px-3 py-3 text-xs text-gray-400 text-center align-top whitespace-nowrap">${raised}</td>
                                <td class="px-3 py-3 text-xs font-bold text-red-400 text-center align-top whitespace-nowrap">${expiry}</td>
                            </tr>
                        `;
                    });
                } 
                
                if (html === '') {
                    html = '<tr><td colspan="5" class="text-center py-6 text-gray-500 text-xs">No records found</td></tr>';
                }
                
                tbody.innerHTML = html;
            } catch (error) {
                console.error("Fetch DDML Details error:", error);
                tbody.innerHTML = '<tr><td colspan="5" class="text-center py-6 text-red-400 text-xs"><i class="fa-solid fa-circle-exclamation mr-1"></i> Error loading data</td></tr>';
            }
        }

        window.exportRedEyeData = function() {
            const listContainer = document.getElementById('redeye-list');
            const rows = listContainer.querySelectorAll('.grid');
            let text = "RED EYE FLIGHT REPORT (04:00 - 09:00)\n";
            text += "--------------------------------------------------\n";
            text += "REG     | FLT     | FROM    | STA  \n";
            text += "--------------------------------------------------\n";

            rows.forEach(row => {
                const cols = row.querySelectorAll('div');
                if (cols.length === 4) {
                    const reg = cols[0].innerText.padEnd(8);
                    const flt = cols[1].innerText.padEnd(8);
                    const from = cols[2].innerText.padEnd(8);
                    const sta = cols[3].innerText;
                    text += `${reg}| ${flt}| ${from}| ${sta}\n`;
                }
            });
            text += "--------------------------------------------------\n";
            text += "Generated by MAA Engineering Link Hub";

            const textarea = document.getElementById('export-textarea');
            textarea.value = text;
            document.getElementById('export-modal').classList.remove('hidden');
        };

        window.export36HrsData = function() {
            const listContainer = document.getElementById('36hrs-list');
            const rows = listContainer.querySelectorAll('.grid');
            let text = "36 HRS CHECK DUE MONITORING\n";
            text += "----------------------------------------\n";
            text += "REG     | REMAINING TIME \n";
            text += "----------------------------------------\n";
            rows.forEach(row => {
                const cols = row.querySelectorAll('div');
                if (cols.length >= 2) {
                    const reg = cols[0].innerText.padEnd(8);
                    const remaining = cols[1].innerText;
                    text += `${reg}| ${remaining}\n`;
                }
            });
            text += "----------------------------------------\n";
            text += "Generated by MAA Engineering Link Hub";

            const textarea = document.getElementById('export-textarea');
            textarea.value = text;
            document.getElementById('export-modal').classList.remove('hidden');
        };

        window.copyExportData = function() {
            const textarea = document.getElementById('export-textarea');
            textarea.select();
            document.execCommand('copy');
            
            const btn = document.querySelector('#export-modal button i.fa-copy').parentElement;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fa-solid fa-check mr-2"></i> Copied!';
            setTimeout(() => {
                btn.innerHTML = originalText;
            }, 2000);
        };

        // --- DATA FETCHING ---
        async function fetchDDMLData() {
            const SHEET_ID = '1D9ed8aGAIWbf_MmfN_Lm4b2s9ZkBETnaQ6u06gobil0';
            const SHEET_NAME = 'ชีต1';
            const RANGE = 'A1:G14'; // เปลี่ยน RANGE ให้คลุมถึงคอลัมน์ G เพื่อดึงข้อมูล OPENED
            const URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}&range=${RANGE}&headers=0`;
            try {
                const res = await fetch(URL, { credentials: 'omit' });
                const text = await res.text();
                
                let jsonText = '';
                const jsonMatch = text.match(/google\.visualization\.Query\.setResponse\((.*)\);/);
                if (jsonMatch && jsonMatch[1]) {
                    jsonText = jsonMatch[1];
                } else if (text.startsWith("/*O_o*/")) {
                    jsonText = text.substring(47).slice(0, -2);
                } else {
                    jsonText = text;
                }
                
                const json = JSON.parse(jsonText);
                
                if (json.table && json.table.rows.length > 0) {
                    const rows = json.table.rows;
                    
                    let dateStrings = [];
                    for(let i=0; i<rows.length; i++) {
                        const aVal = String(rows[i]?.c?.[0]?.v || rows[i]?.c?.[0]?.f || '').trim();
                        if(aVal.includes('_')) {
                            const datePart = aVal.split('_')[0];
                            if(datePart.match(/^\d{4}-\d{2}-\d{2}$/) && !dateStrings.includes(datePart)) {
                                dateStrings.push(datePart);
                            }
                        }
                    }
                    
                    const todayStr = dateStrings[0];
                    const yestStr = dateStrings[1];
                    
                    let today1000 = null, today2200 = null;
                    let yest1000 = null, yest2200 = null;
                    let diff1 = null, diff2 = null, diff3 = null, diff4 = null;
                    
                    for(let i=0; i<rows.length; i++) {
                        if(!rows[i] || !rows[i].c || !rows[i].c[0]) continue;
                        const aVal = String(rows[i].c[0].v || rows[i].c[0].f || '').trim();
                        
                        if(todayStr && aVal === todayStr + '_2200') today2200 = rows[i];
                        if(todayStr && aVal === todayStr + '_1000') today1000 = rows[i];
                        
                        if(yestStr && aVal === yestStr + '_2200') yest2200 = rows[i];
                        if(yestStr && aVal === yestStr + '_1000') yest1000 = rows[i];
                        
                        if(aVal === 'DIFF 1') diff1 = rows[i];
                        if(aVal === 'DIFF 2') diff2 = rows[i];
                        if(aVal === 'DIFF 3') diff3 = rows[i];
                        if(aVal === 'DIFF 4') diff4 = rows[i];
                    }

                    // ดึงค่า OPENED จาก G4 (Row index 3, Column index 6)
                    let openedValue = '-';
                    try {
                        if (rows[3] && rows[3].c && rows[3].c[6] !== undefined && rows[3].c[6] !== null) {
                            openedValue = rows[3].c[6].v !== null ? rows[3].c[6].v : '-';
                        }
                    } catch(e) { console.error("Error fetching OPENED value from G4", e); }

                    // Helper to safely parse and add diffs
                    const getDiffValue = (primaryRow, secondaryRow, colIndex, shouldAdd) => {
                        let val1 = 0;
                        let val2 = 0;
                        
                        if (primaryRow && primaryRow.c && primaryRow.c[colIndex] && primaryRow.c[colIndex].v !== null) {
                            val1 = parseFloat(primaryRow.c[colIndex].v) || 0;
                        }
                        
                        if (shouldAdd && secondaryRow && secondaryRow.c && secondaryRow.c[colIndex] && secondaryRow.c[colIndex].v !== null) {
                            val2 = parseFloat(secondaryRow.c[colIndex].v) || 0;
                        }
                        
                        return val1 + val2;
                    };

                    // TODAY Logic
                    let activeToday = today2200;
                    let todayTime = "22:00";
                    
                    if (today2200 && today2200.c) {
                        const b = parseFloat(today2200.c[1]?.v || 0);
                        const c = parseFloat(today2200.c[2]?.v || 0);
                        const d = parseFloat(today2200.c[3]?.v || 0);
                        if (isNaN(b) || isNaN(c) || isNaN(d) || b === 0 || c === 0 || d === 0) {
                            activeToday = today1000;
                            todayTime = "10:00";
                        }
                    } else {
                        activeToday = today1000;
                        todayTime = "10:00";
                    }

                    // YESTERDAY Logic
                    let activeYest = yest2200;
                    let yestTime = "22:00";
                    
                    if (yest2200 && yest2200.c) {
                        const b = parseFloat(yest2200.c[1]?.v || 0);
                        const c = parseFloat(yest2200.c[2]?.v || 0);
                        const d = parseFloat(yest2200.c[3]?.v || 0);
                        if (isNaN(b) || isNaN(c) || isNaN(d) || b === 0 || c === 0 || d === 0) {
                            activeYest = yest1000;
                            yestTime = "10:00";
                        }
                    } else {
                        activeYest = yest1000;
                        yestTime = "10:00";
                    }

                    const formatCalculatedDiff = (val, isTotal=false) => {
                        if (val === 0 || isNaN(val)) return ``; 
                        const textSize = isTotal ? 'text-sm' : 'text-[9px]';
                        const iconSize = isTotal ? 'text-sm' : 'text-[8px]';
                        
                        if (val < 0) {
                            return `<i class="fa-solid fa-arrow-down text-green-400 ${iconSize} mr-0.5"></i><span class="text-green-400 font-bold ${textSize}">${Math.abs(val)}</span>`;
                        } else {
                            return `<i class="fa-solid fa-arrow-up text-red-400 ${iconSize} mr-0.5"></i><span class="text-red-400 font-bold ${textSize}">${val}</span>`;
                        }
                    };

                    // TODAY Rendering
                    if (activeToday && activeToday.c) {
                        document.getElementById('ddml-total').textContent = activeToday.c[4]?.v !== undefined ? activeToday.c[4].v : '-';
                        document.getElementById('ddml-cat').textContent = activeToday.c[1]?.v !== undefined ? activeToday.c[1].v : '-';
                        document.getElementById('ddml-amd').textContent = activeToday.c[2]?.v !== undefined ? activeToday.c[2].v : '-';
                        document.getElementById('ddml-str').textContent = activeToday.c[3]?.v !== undefined ? activeToday.c[3].v : '-';
                        document.getElementById('ddml-time-badge').textContent = todayTime;
                        
                        let useBothDiffs = (activeToday === today2200);
                        if (useBothDiffs) {
                            document.getElementById('ddml-cat-diff').innerHTML = formatCalculatedDiff(getDiffValue(diff1, diff2, 1, true));
                            document.getElementById('ddml-amd-diff').innerHTML = formatCalculatedDiff(getDiffValue(diff1, diff2, 2, true));
                            document.getElementById('ddml-str-diff').innerHTML = formatCalculatedDiff(getDiffValue(diff1, diff2, 3, true));
                            document.getElementById('ddml-total-diff').innerHTML = formatCalculatedDiff(getDiffValue(diff1, diff2, 4, true), true);
                        } else {
                            document.getElementById('ddml-cat-diff').innerHTML = formatCalculatedDiff(getDiffValue(diff2, null, 1, false));
                            document.getElementById('ddml-amd-diff').innerHTML = formatCalculatedDiff(getDiffValue(diff2, null, 2, false));
                            document.getElementById('ddml-str-diff').innerHTML = formatCalculatedDiff(getDiffValue(diff2, null, 3, false));
                            document.getElementById('ddml-total-diff').innerHTML = formatCalculatedDiff(getDiffValue(diff2, null, 4, false), true);
                        }
                    }

                    // YESTERDAY Rendering
                    if (activeYest && activeYest.c) {
                        document.getElementById('yest-total').textContent = activeYest.c[4]?.v !== undefined ? activeYest.c[4].v : '-';
                        document.getElementById('yest-cat').textContent = activeYest.c[1]?.v !== undefined ? activeYest.c[1].v : '-';
                        document.getElementById('yest-amd').textContent = activeYest.c[2]?.v !== undefined ? activeYest.c[2].v : '-';
                        document.getElementById('yest-str').textContent = activeYest.c[3]?.v !== undefined ? activeYest.c[3].v : '-';
                        document.getElementById('yest-time-badge').textContent = yestTime;
                        
                        document.getElementById('yest-closed').textContent = activeYest.c[5]?.v !== undefined ? activeYest.c[5].v : '-';
                        document.getElementById('yest-opened').textContent = openedValue; // แสดงค่าของ OPENED
                        
                        let useBothDiffs = (activeYest === yest2200);
                        if (useBothDiffs) {
                            document.getElementById('yest-cat-diff').innerHTML = formatCalculatedDiff(getDiffValue(diff3, diff4, 1, true));
                            document.getElementById('yest-amd-diff').innerHTML = formatCalculatedDiff(getDiffValue(diff3, diff4, 2, true));
                            document.getElementById('yest-str-diff').innerHTML = formatCalculatedDiff(getDiffValue(diff3, diff4, 3, true));
                            document.getElementById('yest-total-diff').innerHTML = formatCalculatedDiff(getDiffValue(diff3, diff4, 4, true), true);
                        } else {
                            document.getElementById('yest-cat-diff').innerHTML = formatCalculatedDiff(getDiffValue(diff4, null, 1, false));
                            document.getElementById('yest-amd-diff').innerHTML = formatCalculatedDiff(getDiffValue(diff4, null, 2, false));
                            document.getElementById('yest-str-diff').innerHTML = formatCalculatedDiff(getDiffValue(diff4, null, 3, false));
                            document.getElementById('yest-total-diff').innerHTML = formatCalculatedDiff(getDiffValue(diff4, null, 4, false), true);
                        }
                    }
                }
            } catch (error) {
                console.error("Error fetching DDML:", error);
                document.getElementById('ddml-total').textContent = "Err";
            }
        }

        async function fetchRedEyeData() {
            const SHEET_ID = '1CEGBX67w-EucpDNWsZBcpEs5G3ZmmqICp8oLdlzKo9c';
            const GID = '0';
            const URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=${GID}&headers=1`;
            const listContainer = document.getElementById('redeye-list');
            try {
                const res = await fetch(URL);
                if (!res.ok) { throw new Error(`HTTP Status: ${res.status}`); }
                const text = await res.text();
                const jsonText = text.substring(47).slice(0, -2);
                const json = JSON.parse(jsonText);
                let html = '';
                if (json.table && json.table.rows.length > 0) {
                    json.table.rows.forEach(row => {
                        const r = row.c;
                        if (!r) return;
                        const reg = r[0] ? (r[0].f || r[0].v || '') : '';
                        const flt = r[1] ? (r[1].f || r[1].v || '') : '';
                        const from = r[2] ? (r[2].f || r[2].v || '') : ''; 
                        let sta = r[3] ? (r[3].f || r[3].v || '') : '';   

                        if (reg.toLowerCase().includes('reg') || reg.toLowerCase().includes('ทะเบียน')) return;
                        if (reg === '' && flt === '') return;

                        html += `
                            <div class="grid grid-cols-4 gap-1 py-1.5 border-b border-gray-700/50 hover:bg-white/5 transition px-1">
                                <div class="text-center text-xs font-mono text-purple-300">${reg}</div>
                                <div class="text-center text-xs text-gray-300">${flt}</div>
                                <div class="text-center text-xs text-gray-400 truncate">${from}</div>
                                <div class="text-center text-xs font-bold text-white">${sta}</div>
                            </div>
                        `;
                    });
                } else {
                    html = '<div class="text-center text-xs text-gray-500 py-4">No Data</div>';
                }
                listContainer.innerHTML = html;
            } catch (error) {
                console.error("Error fetching Red Eye Data:", error);
                listContainer.innerHTML = `<div class="text-center text-xs text-red-400 py-4">Load Failed</div>`;
            }
        }

        async function fetch36HrsData() {
            const SHEET_ID = '1X7VKdTDbFLcMRlfKIUvrTOi9dxSuvFsaA7qrixtEJ4I';
            const SHEET_NAME = 'MAAA';
            const URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}&headers=1`;
            const listContainer = document.getElementById('36hrs-list');

            try {
                const res = await fetch(URL);
                if (!res.ok) { throw new Error(`HTTP Status: ${res.status}`); }
                const text = await res.text();
                const jsonText = text.substring(47).slice(0, -2);
                const json = JSON.parse(jsonText);
                let html = '';
                if (json.table && json.table.rows.length > 0) {
                    json.table.rows.forEach(row => {
                        const r = row.c;
                        if (!r) return;
                        const reg = r[0] ? (r[0].f || r[0].v || '') : '';
                        const remaining = r[1] ? (r[1].f || r[1].v || '') : '';

                        if (reg.toLowerCase().includes('reg') || reg.toLowerCase().includes('ทะเบียน')) return;
                        if (reg === '' && remaining === '') return;

                        const textColorClass = remaining.includes('-') ? 'text-red-400' : 'text-orange-100';

                        html += `
                            <div class="grid grid-cols-3 gap-1 py-1.5 border-b border-gray-700/50 hover:bg-white/5 transition px-1">
                                <div class="col-span-1 text-left pl-2 text-xs font-mono text-orange-300 font-bold">9M-${reg}</div>
                                <div class="col-span-2 text-right pr-2 text-xs font-bold ${textColorClass} truncate">${remaining}</div>
                            </div>
                        `;
                    });
                } else {
                    html = '<div class="text-center text-xs text-gray-500 py-4">No Data</div>';
                }
                listContainer.innerHTML = html;
            } catch (error) {
                console.error("Error fetching 36HRS Data:", error);
                listContainer.innerHTML = `<div class="text-center text-xs text-red-400 py-4">Load Failed</div>`;
            }
        }

        async function fetchNewDDMLReport() {
            const SHEET_ID = '19voRUUOGILuqz-GlEZhhDrRBuYFpsm9sog89O_7OMWQ'; 
            const URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=0&headers=1`;
            const listContainer = document.getElementById('new-ddml-list');

            try {
                const res = await fetch(URL, { credentials: 'omit' });
                if (!res.ok) { throw new Error(`HTTP Status: ${res.status}`); }
                const text = await res.text();
                
                let jsonText = '';
                const jsonMatch = text.match(/google\.visualization\.Query\.setResponse\((.*)\);/);
                
                if (jsonMatch && jsonMatch[1]) {
                    jsonText = jsonMatch[1];
                } else if (text.startsWith("/*O_o*/")) {
                    jsonText = text.substring(47).slice(0, -2);
                } else {
                    jsonText = text;
                }
                
                const json = JSON.parse(jsonText);
                
                let html = '';
                if (json.table && json.table.rows.length > 0) {
                    
                    // 1. Process data for Sorting
                    const rows = json.table.rows.filter(r => r.c).map(r => {
                        const cellDate = r.c[0];
                        let dateObj = null;
                        
                        if (cellDate) {
                             if (cellDate.v && typeof cellDate.v === 'string' && cellDate.v.startsWith('Date(')) {
                                 const parts = cellDate.v.match(/\d+/g);
                                 if (parts) {
                                     dateObj = new Date(parts[0], parts[1], parts[2], parts[3]||0, parts[4]||0, parts[5]||0);
                                 }
                             } else if (cellDate.f) {
                                 // Simple string parsing fallback
                                 const d = new Date(cellDate.f);
                                 dateObj = isNaN(d) ? new Date(0) : d;
                             }
                        }
                        return { data: r.c, dateObj: dateObj || new Date(0) };
                    });

                    // 2. Sort by Date Descending (Newest first)
                    rows.sort((a, b) => b.dateObj - a.dateObj);

                    // Track if we need to auto-scroll due to a new item
                    let hasNewItem = false;
                    if (rows.length > 0) {
                        const currentNewestTime = rows[0].dateObj.getTime();
                        if (!window.lastNewDDMLTime) {
                            window.lastNewDDMLTime = currentNewestTime;
                        } else if (currentNewestTime > window.lastNewDDMLTime) {
                            hasNewItem = true;
                            window.lastNewDDMLTime = currentNewestTime;
                        }
                    }

                    // 3. Render
                    rows.forEach(item => {
                        const r = item.data;
                        const dateObj = item.dateObj;
                        
                        let displayDate = "";
                        let displayTime = "";
                        
                        // Use parsed Date Object for display formatting
                        if (dateObj.getTime() !== 0) {
                            const yy = dateObj.getFullYear().toString().slice(-2);
                            const mm = String(dateObj.getMonth() + 1).padStart(2, '0');
                            const dd = String(dateObj.getDate()).padStart(2, '0');
                            const hh = String(dateObj.getHours()).padStart(2, '0');
                            const min = String(dateObj.getMinutes()).padStart(2, '0');
                            
                            displayDate = `${dd}/${mm}/${yy}`;
                            displayTime = `${hh}:${min}`;
                        } else if (r[0] && r[0].f) {
                             // Fallback to string splitting if date parse failed but string exists
                             const parts = r[0].f.split(' ');
                             displayDate = parts[0];
                             if(parts.length > 1) displayTime = parts[1].substring(0,5);
                        }

                        let isNew = false;
                        if (dateObj.getTime() !== 0) {
                            const now = new Date();
                            const diffMs = now - dateObj;
                            if (diffMs >= 0 && diffMs < 5 * 60 * 1000) { // 5 minutes
                                isNew = true;
                            }
                        }

                        const reg = r[1] ? (r[1].f || r[1].v || '') : '';
                        const ddml = r[2] ? (r[2].f || r[2].v || '') : '';
                        const exp = r[3] ? (r[3].f || r[3].v || '') : '';
                        const defect = r[4] ? (r[4].f || r[4].v || '') : '';
                        const link = r[5] ? (r[5].f || r[5].v || '') : '#';

                        if (displayDate === '' && reg === '') return;

                        const newBadge = isNew ? `<span class="px-1 py-0.5 bg-red-600 text-white text-[8px] rounded animate-pulse font-bold mt-0.5">NEW</span>` : '';

                        html += `
                            <div class="flex items-center py-2 border-b border-gray-700/50 hover:bg-white/5 transition px-1 text-[11px] text-gray-300">
                                <div class="w-[14%] text-center font-mono text-gray-400 leading-tight">
                                    <div>${displayDate}</div>
                                    <div class="text-[9px] text-gray-500">${displayTime}</div>
                                </div>
                                <div class="w-[12%] text-center font-bold text-orange-300 flex flex-col items-center justify-center">
                                    <span>${reg}</span>
                                    ${newBadge}
                                </div>
                                <div class="w-[12%] text-center text-blue-300 font-mono">${ddml}</div>
                                <div class="w-[12%] text-center text-red-300 font-mono">${exp}</div>
                                <div class="flex-1 text-left px-2 truncate text-white" title="${defect}">${defect}</div>
                                <div class="w-[10%] text-center">
                                    <a href="${link}" target="_blank" class="bg-blue-600 hover:bg-blue-500 text-white px-2 py-1 rounded-[2px] text-[10px] uppercase tracking-wide transition shadow-sm">View</a>
                                </div>
                            </div>
                        `;
                    });
                    
                    listContainer.innerHTML = html;

                    // Execute Auto-Scroll if new data is detected
                    if (hasNewItem) {
                        setTimeout(() => {
                            listContainer.scrollTo({ top: 0, behavior: 'smooth' });
                        }, 100); // slight delay to ensure DOM is fully rendered before scrolling
                    }

                } else {
                    html = '<div class="text-center text-xs text-gray-500 py-4">No Data Available</div>';
                    listContainer.innerHTML = html;
                }
            } catch (error) {
                console.error("Error fetching NEW DDML Report:", error);
                listContainer.innerHTML = `<div class="text-center text-xs text-red-400 py-4">Load Failed</div>`;
            }
        }

        // --- FETCH DASH 6 DATA (Maintenance Tasks & Hangarage) ---
        async function fetchDash6Data() {
            const SHEET_ID = '1ZwdP740a70_PI72RM0Ywx594HSBxZX8tIOsRIfxgFxQ'; 
            const SHEET_NAME = 'ชีต1';
            const RANGE = 'A1:N20'; 
            
            // ดึงข้อมูลทั้งหมดโดยไม่ใช้ tq query parameter เพื่อป้องกัน Error จาก Google Visualization API
            const URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}&range=${RANGE}&headers=0`;
            
            const leftList = document.getElementById('dash6-left-list');
            const rightList = document.getElementById('dash6-right-list');

            try {
                const res = await fetch(URL, { credentials: 'omit' });
                if (!res.ok) throw new Error(`HTTP Status: ${res.status}`);
                const text = await res.text();
                
                let jsonText = '';
                const jsonMatch = text.match(/google\.visualization\.Query\.setResponse\((.*)\);/);
                if (jsonMatch && jsonMatch[1]) {
                    jsonText = jsonMatch[1];
                } else if (text.startsWith("/*O_o*/")) {
                    jsonText = text.substring(47).slice(0, -2);
                } else {
                    jsonText = text;
                }
                const json = JSON.parse(jsonText);

                if (json.table && json.table.rows.length > 0) {
                    const rows = json.table.rows;
                    
                    // -- จัดการข้อมูลฝั่งซ้าย (D4 to D14 -> index 3 to 13) --
                    // เมื่อดึง A1:N20 คอลัมน์ D จะอยู่ที่ Index 3 เสมอ (A=0, B=1, C=2, D=3)
                    const leftTasks = [
                        { label: 'E CHK', rowIdx: 3 },
                        { label: 'DISINSECTION', rowIdx: 4 },
                        { label: 'BSI', rowIdx: 5 },
                        { label: 'OMV', rowIdx: 6 },
                        { label: 'NDT', rowIdx: 7 },
                        { label: 'LESSOR VISIT', rowIdx: 8 },
                        { label: 'URGENT DMC', rowIdx: 9 },
                        { label: 'DEEP CLEANING (REQ GPU & ACU)', rowIdx: 10 },
                        { label: 'EXTERIOR WASHING', rowIdx: 11 },
                        { label: 'C OF A', rowIdx: 12 },
                        { label: 'AEROWASH', rowIdx: 13 }
                    ];

                    let leftHtml = '';
                    leftTasks.forEach(task => {
                        let val = '-';
                        if (rows[task.rowIdx] && rows[task.rowIdx].c && rows[task.rowIdx].c[3]) {
                            val = rows[task.rowIdx].c[3].v || rows[task.rowIdx].c[3].f || '-';
                        }
                        leftHtml += `
                            <div class="flex justify-between items-center bg-gray-800/40 p-1.5 rounded border border-gray-700/50 hover:bg-white/5 transition">
                                <span class="text-[8px] text-gray-400 tracking-wider w-[70%] truncate" title="${task.label}">${task.label}</span>
                                <span class="text-[9px] font-bold text-white text-right truncate w-[30%]">${val}</span>
                            </div>
                        `;
                    });
                    leftList.innerHTML = leftHtml;

                    // -- จัดการข้อมูลฝั่งขวา (I4:N15 -> row index 3 to 14) --
                    // Cols: I=8, J=9, L=11, M=12, N=13
                    let rightHtml = '';
                    for (let i = 3; i <= 14; i++) {
                        if (!rows[i] || !rows[i].c) continue;
                        
                        const reg = rows[i].c[8] ? (rows[i].c[8].f || rows[i].c[8].v || '') : '';
                        const task = rows[i].c[9] ? (rows[i].c[9].f || rows[i].c[9].v || '') : '';
                        
                        // Parse date column (L is index 11)
                        let date = '';
                        if (rows[i].c[11]) {
                            if (rows[i].c[11].f) {
                                date = rows[i].c[11].f;
                            } else if (typeof rows[i].c[11].v === 'string' && rows[i].c[11].v.startsWith('Date(')) {
                                const parts = rows[i].c[11].v.match(/\d+/g);
                                if (parts) {
                                    const d = new Date(parts[0], parts[1], parts[2]);
                                    date = `${String(d.getDate()).padStart(2, '0')}/${String(d.getMonth() + 1).padStart(2, '0')}/${String(d.getFullYear()).slice(-2)}`;
                                }
                            } else {
                                date = rows[i].c[11].v;
                            }
                        }

                        const coutBy = rows[i].c[12] ? (rows[i].c[12].f || rows[i].c[12].v || '') : '';
                        const lineNum = rows[i].c[13] ? (rows[i].c[13].f || rows[i].c[13].v || '') : '';

                        if (!reg && !task) continue; // ข้ามบรรทัดที่ว่างเปล่า

                        rightHtml += `
                            <div class="flex items-center py-1.5 border-b border-gray-700/50 hover:bg-white/5 transition px-1 text-[9px] text-gray-300 space-x-1">
                                <div class="w-[15%] text-center font-bold text-purple-300 truncate" title="${reg}">${reg}</div>
                                <div class="w-[30%] text-left truncate text-white" title="${task}">${task}</div>
                                <div class="w-[20%] text-center font-mono text-gray-400 truncate">${date}</div>
                                <div class="w-[20%] text-center text-blue-300 truncate" title="${coutBy}">${coutBy}</div>
                                <div class="w-[15%] text-center text-orange-300 font-mono truncate">${lineNum}</div>
                            </div>
                        `;
                    }
                    if(!rightHtml) rightHtml = '<div class="text-center text-xs text-gray-500 py-4">No Data</div>';
                    rightList.innerHTML = rightHtml;

                }
            } catch (error) {
                console.error("Error fetching Dash 6:", error);
                leftList.innerHTML = `<div class="text-center text-xs text-red-400 py-4">Load Failed</div>`;
                rightList.innerHTML = `<div class="text-center text-xs text-red-400 py-4">Load Failed</div>`;
            }
        }

        const OPT_DATA_URL = 'https://script.google.com/macros/s/AKfycbzUXDItR3eFn_16B68oz953r_F1PgoQ4kUuyfivYEG0Gb1RGRvSyVd8nKqv9flIgx4x/exec';
        let otpChart = null;

        async function fetchOTPData() {
            const trendEl = document.getElementById('otp-trend');
            const valueEl = document.getElementById('otp-value');
            if (trendEl) trendEl.textContent = 'SYNCING...';
            
            try {
                const response = await fetch(`${OPT_DATA_URL}?t=${Date.now()}`, { redirect: 'follow', credentials: 'omit' });
                const data = await response.json();
                const validData = data.filter(d => !isNaN(parseFloat(d.valueB || d.value)) && parseFloat(d.valueB || d.value) > 0.001);

                if (validData.length > 0) {
                    const labels = validData.map(d => d.date);
                    const valuesB = validData.map(d => {
                        let n = parseFloat(d.valueB || d.value);
                        return (n > 0 && n <= 1.0) ? (n * 100) : n;
                    });
                    const valuesC = validData.map(d => {
                        let n = parseFloat(d.valueC || 0);
                        return (n > 0 && n <= 0.05) ? (n * 100) : n;
                    });

                    updateChart(labels, valuesB, valuesC);
                    if (valueEl) valueEl.textContent = valuesB[valuesB.length - 1].toFixed(2) + '%';
                    if (trendEl) trendEl.textContent = 'ONLINE';
                }
            } catch (err) {
                console.error('OTP error:', err);
            }
        }

        function updateChart(labels, valuesB, valuesC) {
            const canvas = document.getElementById('otpChart');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            if (otpChart) {
                otpChart.data.labels = labels;
                otpChart.data.datasets[0].data = valuesB;
                otpChart.data.datasets[1].data = valuesC;
                otpChart.update();
            } else {
                otpChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            { 
                                label: 'OTP15', 
                                data: valuesB, 
                                borderColor: '#60a5fa', 
                                tension: 0.4, 
                                fill: true, 
                                backgroundColor: 'rgba(96, 165, 250, 0.1)', 
                                pointRadius: 3,
                                pointHoverRadius: 6,
                                pointBackgroundColor: '#60a5fa',
                                pointBorderColor: '#1f2937',
                                pointBorderWidth: 2
                            },
                            { 
                                label: 'ENG DLY', 
                                data: valuesC, 
                                borderColor: '#f87171', 
                                tension: 0.4, 
                                fill: true, 
                                backgroundColor: 'rgba(248, 113, 113, 0.1)', 
                                pointRadius: 3,
                                pointHoverRadius: 6,
                                pointBackgroundColor: '#f87171',
                                pointBorderColor: '#1f2937',
                                pointBorderWidth: 2
                            }
                        ]
                    },
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false, 
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        plugins: { 
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(17, 24, 39, 0.95)',
                                titleColor: '#9ca3af',
                                titleFont: { size: 10 },
                                bodyFont: { size: 11, weight: 'bold' },
                                padding: 10,
                                cornerRadius: 6,
                                displayColors: true,
                                borderColor: 'rgba(75, 85, 99, 0.5)',
                                borderWidth: 1,
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) { label += ': '; }
                                        if (context.parsed.y !== null) { label += context.parsed.y.toFixed(2) + '%'; }
                                        return label;
                                    }
                                }
                            }
                        }, 
                        scales: { 
                            x: { 
                                ticks: { color: '#9ca3af', font: { size: 8 }, maxRotation: 0 },
                                grid: { display: false, drawBorder: false }
                            }, 
                            y: { 
                                ticks: { color: '#9ca3af', font: { size: 8 } },
                                grid: { color: 'rgba(75, 85, 99, 0.2)', borderDash: [3, 3], drawBorder: false },
                                beginAtZero: true
                            } 
                        } 
                    }
                });
            }
        }

        async function fetchCockpitWindowData() {
            const URL = `https://docs.google.com/spreadsheets/d/1cEYRPEKytVAeVLgbGJXpCkQaXDsWBkSSUf3BXTeFKfg/gviz/tq?tqx=out:json&sheet=ชีต1&range=A2:C2`;
            try {
                const res = await fetch(URL);
                const text = await res.text();
                const json = JSON.parse(text.substring(47).slice(0, -2));
                if (json.table && json.table.rows.length > 0) {
                    const row = json.table.rows[0].c;
                    const n = parseInt(row[0].v || 0), o = parseInt(row[1].v || 0), c = parseInt(row[2].v || 0);
                    document.getElementById('cw-normal').textContent = n;
                    document.getElementById('cw-obs').textContent = o;
                    document.getElementById('cw-crit').textContent = c;
                    document.getElementById('cw-total').textContent = n + o + c;
                }
            } catch (e) { console.error(e); }
            document.getElementById('cockpit-loading').classList.add('hidden');
        }

        fetchOTPData();
        fetchDDMLData();
        fetchRedEyeData();
        fetch36HrsData();
        fetchCockpitWindowData();
        fetchNewDDMLReport();
        fetchDash6Data();
    </script>
</body>
</html>



